/*

Siesta 3.0.1
Copyright(c) 2009-2015 Bryntum AB
http://bryntum.com/contact
http://bryntum.com/products/siesta/license

*/
!function(){var a={};a.C="undefined"!=typeof JOOSE_CFG?JOOSE_CFG:{};a.is_IE="\v"=="v";a.is_NodeJS=Boolean("undefined"!=typeof process&&process.pid);a.top=a.is_NodeJS&&global||this;a.stub=function(){return function(){throw Error("Modules can not be instantiated");}};a.VERSION="3.50.1";"undefined"!=typeof module&&(module.exports=a);this.Joose=a;a.A={each:function(a,b,c){c=c||this;for(var d=0,e=a.length;d<e;d++)if(!1===b.call(c,a[d],d))return!1},eachR:function(a,b,c){c=c||this;for(var d=a.length-1;0<=
d;d--)if(!1===b.call(c,a[d],d))return!1},exists:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return!0;return!1},map:function(a,b,c){c=c||this;for(var d=[],e=0,f=a.length;e<f;e++)d.push(b.call(c,a[e],e));return d},grep:function(b,c){var d=[];a.A.each(b,function(a){c(a)&&d.push(a)});return d},remove:function(b,c){var d=[];a.A.each(b,function(a){a!==c&&d.push(a)});return d}};a.S={saneSplit:function(a,b){var c=(a||"").split(b);1!=c.length||c[0]||c.shift();return c},uppercaseFirst:function(a){return a.substr(0,
1).toUpperCase()+a.substr(1,a.length-1)},strToClass:function(b,c){var d=c||a.top;a.A.each(b.split("."),function(a){if(d)d=d[a];else return!1});return d}};var b=function(){},c=["hasOwnProperty","valueOf","toString","constructor"],d=!0,e;for(e in{toString:1})d=!1;a.O={each:function(b,k,m){m=m||this;for(var e in b)if(!1===k.call(m,b[e],e))return!1;if(d)return a.A.each(c,function(a){if(b.hasOwnProperty(a))return k.call(m,b[a],a)})},eachOwn:function(b,c,d){d=d||this;return a.O.each(b,function(a,e){if(b.hasOwnProperty(e))return c.call(d,
a,e)},d)},copy:function(b,c){c=c||{};a.O.each(b,function(a,b){c[b]=a});return c},copyOwn:function(b,c){c=c||{};a.O.eachOwn(b,function(a,b){c[b]=a});return c},getMutableCopy:function(a){b.prototype=a;return new b},extend:function(b,c){return a.O.copy(c,b)},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},isInstance:function(a){return a&&a.meta&&a.constructor==a.meta.c},isClass:function(a){return a&&a.meta&&a.meta.c==a},wantArray:function(a){return a instanceof Array?a:[a]},
isFunction:function(a){return"function"==typeof a&&a.constructor!=/ /.constructor}};a.I={Array:function(){return[]},Object:function(){return{}},Function:function(){return arguments.callee},Now:function(){return new Date}};a.Proto=a.stub();a.Proto.Empty=a.stub();a.Proto.Empty.meta={};(function(){a.Proto.Object=a.stub();var b=function(){var a=b.caller;a==c&&(a=a.caller);if(!a.SUPER)throw"Invalid call to SUPER";return a.SUPER[a.methodName].apply(this,arguments)},c=function(a){return this.SUPER.apply(this,
a)};a.Proto.Object.prototype={SUPERARG:c,SUPER:b,INNER:function(){throw"Invalid call to INNER";},BUILD:function(a){return 1==arguments.length&&"object"==typeof a&&a||{}},initialize:function(){},toString:function(){return"a "+this.meta.name}};a.Proto.Object.meta={constructor:a.Proto.Object,methods:a.O.copy(a.Proto.Object.prototype),attributes:{}};a.Proto.Object.prototype.meta=a.Proto.Object.meta})();(function(){a.Proto.Class=function(){return this.initialize(this.BUILD.apply(this,arguments))||this};
var b={VERSION:null,AUTHORITY:null,constructor:a.Proto.Class,superClass:null,name:null,attributes:null,methods:null,meta:null,c:null,defaultSuperClass:a.Proto.Object,BUILD:function(a,b){this.name=a;return{__extend__:b||{}}},initialize:function(a){a=a.__extend__;this.VERSION=a.VERSION;this.AUTHORITY=a.AUTHORITY;delete a.VERSION;delete a.AUTHORITY;this.c=this.extractConstructor(a);this.adaptConstructor(this.c);a.constructorOnly?delete a.constructorOnly:this.construct(a)},construct:function(a){if(this.prepareProps(a)){var b=
this.superClass=this.extractSuperClass(a);this.processSuperClass(b);this.adaptPrototype(this.c.prototype);this.finalize(a)}},finalize:function(a){this.processStem(a);this.extend(a)},prepareProps:function(a){return!0},extractConstructor:function(a){var b=a.hasOwnProperty("constructor")?a.constructor:this.defaultConstructor();delete a.constructor;return b},extractSuperClass:function(a){if(a.hasOwnProperty("isa")&&!a.isa)throw Error("Attempt to inherit from undefined superclass ["+this.name+"]");var b=
a.isa||this.defaultSuperClass;delete a.isa;return b},processStem:function(){var b=this.superClass.meta;this.methods=a.O.getMutableCopy(b.methods||{});this.attributes=a.O.getMutableCopy(b.attributes||{})},initInstance:function(b,c){a.O.copyOwn(c,b)},defaultConstructor:function(){return function(a){var b=this.BUILD,b=b&&b.apply(this,arguments)||a||{},c=this.meta;c.initInstance(this,b);return c.hasMethod("initialize")&&this.initialize(b)||this}},processSuperClass:function(b){var c=b.prototype;if(!b.meta){var h=
a.O.copy(c);h.isa=a.Proto.Empty;delete h.constructor;h=new this.defaultSuperClass.meta.constructor(null,h);b.meta=c.meta=h;h.c=b}this.c.prototype=a.O.getMutableCopy(c);this.c.superClass=c},adaptConstructor:function(a){a.meta=this;a.hasOwnProperty("toString")||(a.toString=function(){return this.meta.name})},adaptPrototype:function(a){a.constructor=this.c;a.meta=this},addMethod:function(a,b){b.SUPER=this.superClass.prototype;b.methodName=a;this.methods[a]=b;this.c.prototype[a]=b},addAttribute:function(a,
b){this.attributes[a]=b;this.c.prototype[a]=b},removeMethod:function(a){delete this.methods[a];delete this.c.prototype[a]},removeAttribute:function(a){delete this.attributes[a];delete this.c.prototype[a]},hasMethod:function(a){return Boolean(this.methods[a])},hasAttribute:function(a){return void 0!==this.attributes[a]},hasOwnMethod:function(a){return this.hasMethod(a)&&this.methods.hasOwnProperty(a)},hasOwnAttribute:function(a){return this.hasAttribute(a)&&this.attributes.hasOwnProperty(a)},extend:function(b){a.O.eachOwn(b,
function(b,c){"meta"!=c&&"constructor"!=c&&(a.O.isFunction(b)&&!b.meta?this.addMethod(c,b):this.addAttribute(c,b))},this)},subClassOf:function(a,b){return this.subClass(b,null,a)},subClass:function(a,b,c){a=a||{};a.isa=c||this.c;return(new this.constructor(b,a)).c},instantiate:function(){var a=function(){};a.prototype=this.c.prototype;a=new a;return this.c.apply(a,arguments)||a}};a.Proto.Class.prototype=a.O.getMutableCopy(a.Proto.Object.prototype);a.O.extend(a.Proto.Class.prototype,b);a.Proto.Class.prototype.meta=
new a.Proto.Class("Joose.Proto.Class",b);a.Proto.Class.meta.addMethod("isa",function(a){var b=function(){};b.prototype=this.c.prototype;return new b instanceof a})})();a.Managed=a.stub();a.Managed.Property=(new a.Proto.Class("Joose.Managed.Property",{name:null,init:null,value:null,definedIn:null,initialize:function(b){a.Managed.Property.superClass.initialize.call(this,b);this.computeValue()},computeValue:function(){this.value=this.init},preApply:function(a){},postUnApply:function(a){},apply:function(a){a[this.name]=
this.value},isAppliedTo:function(a){return a[this.name]==this.value},unapply:function(a){if(!this.isAppliedTo(a))throw"Unapply of property ["+this.name+"] from ["+a+"] failed";delete a[this.name]},cloneProps:function(){return{name:this.name,init:this.init,definedIn:this.definedIn}},clone:function(a){var b=this.cloneProps();b.name=a||b.name;return new this.constructor(b)}})).c;a.Managed.Property.ConflictMarker=(new a.Proto.Class("Joose.Managed.Property.ConflictMarker",{isa:a.Managed.Property,apply:function(a){throw Error("Attempt to apply ConflictMarker ["+
this.name+"] to ["+a+"]");}})).c;a.Managed.Property.Requirement=(new a.Proto.Class("Joose.Managed.Property.Requirement",{isa:a.Managed.Property,apply:function(a){if(!a.meta.hasMethod(this.name))throw Error("Requirement ["+this.name+"], defined in ["+this.definedIn.definedIn.name+"] is not satisfied for class ["+a+"]");},unapply:function(a){}})).c;a.Managed.Property.Attribute=(new a.Proto.Class("Joose.Managed.Property.Attribute",{isa:a.Managed.Property,slot:null,initialize:function(){a.Managed.Property.Attribute.superClass.initialize.apply(this,
arguments);this.slot=this.name},apply:function(a){a.prototype[this.slot]=this.value},isAppliedTo:function(a){return a.prototype[this.slot]==this.value},unapply:function(a){if(!this.isAppliedTo(a))throw"Unapply of property ["+this.name+"] from ["+a+"] failed";delete a.prototype[this.slot]},clearValue:function(a){delete a[this.slot]},hasValue:function(a){return a.hasOwnProperty(this.slot)},getRawValueFrom:function(a){return a[this.slot]},setRawValueTo:function(a,b){a[this.slot]=b;return this}})).c;
a.Managed.Property.MethodModifier=(new a.Proto.Class("Joose.Managed.Property.MethodModifier",{isa:a.Managed.Property,prepareWrapper:function(){throw"Abstract method [prepareWrapper] of "+this+" was called";},apply:function(a){var b=this.name,c=a.prototype,d=c.hasOwnProperty(b),e=c[b],f=a.meta.superClass.prototype,g=this.prepareWrapper({name:b,modifier:this.value,isOwn:d,originalCall:d?e:function(){return f[b].apply(this,arguments)},superProto:f,target:a});d&&(g.__ORIGINAL__=e);g.__CONTAIN__=this.value;
g.__METHOD__=this;this.value.displayName=this.getDisplayName(a);g.displayName="internal wrapper";c[b]=g},getDisplayName:function(a){return a.meta.name+"["+this.name+"]"},isAppliedTo:function(a){return(a=a.prototype[this.name])&&a.__CONTAIN__==this.value},unapply:function(a){var b=this.name,c=a.prototype,d=c[b].__ORIGINAL__;if(!this.isAppliedTo(a))throw"Unapply of method ["+b+"] from class ["+a+"] failed";d?c[b]=d:delete c[b]}})).c;a.Managed.Property.MethodModifier.Override=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.Override",
{isa:a.Managed.Property.MethodModifier,prepareWrapper:function(b){var c=b.modifier,d=b.originalCall,e=b.superProto,f=e.meta.constructor,g=d;f!=a.Proto.Class&&f!=a.Proto.Object||b.isOwn&&d.IS_OVERRIDE||(g=function(){var a=this.SUPER;this.SUPER=e.SUPER;var b=d.apply(this,arguments);this.SUPER=a;return b});b=function(){var a=this.SUPER;this.SUPER=g;var b=c.apply(this,arguments);this.SUPER=a;return b};b.IS_OVERRIDE=!0;return b},getDisplayName:function(a){return a.meta.name+"[override "+this.name+"]"}})).c;
a.Managed.Property.MethodModifier.Put=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.Put",{isa:a.Managed.Property.MethodModifier.Override,prepareWrapper:function(b){if(b.isOwn)throw"Method ["+b.name+"] is applying over something ["+b.originalCall+"] in class ["+b.target+"]";return a.Managed.Property.MethodModifier.Put.superClass.prepareWrapper.call(this,b)},getDisplayName:function(a){return a.meta.name+"["+this.name+"]"}})).c;a.Managed.Property.MethodModifier.After=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.After",
{isa:a.Managed.Property.MethodModifier,prepareWrapper:function(a){var b=a.modifier,c=a.originalCall;return function(){var a=c.apply(this,arguments);b.apply(this,arguments);return a}},getDisplayName:function(a){return a.meta.name+"[after "+this.name+"]"}})).c;a.Managed.Property.MethodModifier.Before=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.Before",{isa:a.Managed.Property.MethodModifier,prepareWrapper:function(a){var b=a.modifier,c=a.originalCall;return function(){b.apply(this,arguments);
return c.apply(this,arguments)}},getDisplayName:function(a){return a.meta.name+"[before "+this.name+"]"}})).c;a.Managed.Property.MethodModifier.Around=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.Around",{isa:a.Managed.Property.MethodModifier,prepareWrapper:function(a){var b=a.modifier,c=a.originalCall,d,e=function(){return c.apply(d,arguments)};return function(){d=this;var a=[e];a.push.apply(a,arguments);return b.apply(this,a)}},getDisplayName:function(a){return a.meta.name+"[around "+
this.name+"]"}})).c;a.Managed.Property.MethodModifier.Augment=(new a.Proto.Class("Joose.Managed.Property.MethodModifier.Augment",{isa:a.Managed.Property.MethodModifier,prepareWrapper:function(a){var b=function(){var a=[],c=b;do a.push(c.IS_AUGMENT?c.__CONTAIN__:c),c=c.IS_AUGMENT&&(c.__ORIGINAL__||c.SUPER[c.methodName]);while(c);c=this.INNER;this.INNER=function(){var b=a.pop();return b?b.apply(this,arguments):void 0};var h=this.INNER.apply(this,arguments);this.INNER=c;return h};b.methodName=a.name;
b.SUPER=a.superProto;b.IS_AUGMENT=!0;return b},getDisplayName:function(a){return a.meta.name+"[augment "+this.name+"]"}})).c;a.Managed.PropertySet=(new a.Proto.Class("Joose.Managed.PropertySet",{isa:a.Managed.Property,properties:null,propertyMetaClass:a.Managed.Property,initialize:function(b){a.Managed.PropertySet.superClass.initialize.call(this,b);this.properties=b.properties||{}},addProperty:function(a,b){var c=b.meta||this.propertyMetaClass;delete b.meta;b.definedIn=this;b.name=a;return this.properties[a]=
new c(b)},addPropertyObject:function(a){return this.properties[a.name]=a},removeProperty:function(a){var b=this.properties[a];delete this.properties[a];return b},haveProperty:function(a){return null!=this.properties[a]},haveOwnProperty:function(a){return this.haveProperty(a)&&this.properties.hasOwnProperty(a)},getProperty:function(a){return this.properties[a]},each:function(b,c){a.O.each(this.properties,b,c||this)},eachOwn:function(b,c){a.O.eachOwn(this.properties,b,c||this)},eachAll:function(a,b){this.each(a,
b)},cloneProps:function(){var b=a.Managed.PropertySet.superClass.cloneProps.call(this);b.propertyMetaClass=this.propertyMetaClass;return b},clone:function(b){b=this.cleanClone(b);b.properties=a.O.copyOwn(this.properties);return b},cleanClone:function(a){var b=this.cloneProps();b.name=a||b.name;return new this.constructor(b)},alias:function(b){var c=this.properties;a.O.each(b,function(a,b){var h=c[b];h&&this.addPropertyObject(h.clone(a))},this)},exclude:function(b){var c=this.properties;a.A.each(b,
function(a){delete c[a]})},beforeConsumedBy:function(){},flattenTo:function(b){var c=b.properties;this.eachOwn(function(d,e){var f=c[e];f instanceof a.Managed.Property.ConflictMarker||(c.hasOwnProperty(e)&&null!=f?f!=d&&(b.removeProperty(e),b.addProperty(e,{meta:a.Managed.Property.ConflictMarker})):b.addPropertyObject(d))},this)},composeTo:function(a){this.eachOwn(function(b,c){a.haveOwnProperty(c)||a.addPropertyObject(b)})},composeFrom:function(){if(arguments.length){var b=this.cleanClone();a.A.each(arguments,
function(c){var d=!(c instanceof a.Managed.PropertySet),e=d?c.propertySet:c;e.beforeConsumedBy(this,b);if(d){if(c.alias||c.exclude)e=e.clone();c.alias&&e.alias(c.alias);c.exclude&&e.exclude(c.exclude)}e.flattenTo(b)},this);b.composeTo(this)}},preApply:function(a){this.eachOwn(function(b){b.preApply(a)})},apply:function(a){this.eachOwn(function(b){b.apply(a)})},unapply:function(a){this.eachOwn(function(b){b.unapply(a)})},postUnApply:function(a){this.eachOwn(function(b){b.postUnApply(a)})}})).c;var f=
1;a.Managed.PropertySet.Mutable=(new a.Proto.Class("Joose.Managed.PropertySet.Mutable",{isa:a.Managed.PropertySet,ID:null,derivatives:null,opened:null,composedFrom:null,initialize:function(b){a.Managed.PropertySet.Mutable.superClass.initialize.call(this,b);this.opened=1;this.derivatives={};this.ID=f++;this.composedFrom=[]},addComposeInfo:function(){this.ensureOpen();a.A.each(arguments,function(b){this.composedFrom.push(b);(b instanceof a.Managed.PropertySet?b:b.propertySet).derivatives[this.ID]=this},
this)},removeComposeInfo:function(){this.ensureOpen();a.A.each(arguments,function(b){for(var c=0;c<this.composedFrom.length;){var d=this.composedFrom[c],d=d instanceof a.Managed.PropertySet?d:d.propertySet;b==d?(delete d.derivatives[this.ID],this.composedFrom.splice(c,1)):c++}},this)},ensureOpen:function(){if(!this.opened)throw"Mutation of closed property set: ["+this.name+"]";},addProperty:function(b,c){this.ensureOpen();return a.Managed.PropertySet.Mutable.superClass.addProperty.call(this,b,c)},
addPropertyObject:function(b){this.ensureOpen();return a.Managed.PropertySet.Mutable.superClass.addPropertyObject.call(this,b)},removeProperty:function(b){this.ensureOpen();return a.Managed.PropertySet.Mutable.superClass.removeProperty.call(this,b)},composeFrom:function(){this.ensureOpen();return a.Managed.PropertySet.Mutable.superClass.composeFrom.apply(this,this.composedFrom)},open:function(){this.opened++;1==this.opened&&(a.O.each(this.derivatives,function(a){a.open()}),this.deCompose())},close:function(){if(!this.opened)throw"Unmatched 'close' operation on property set: ["+
this.name+"]";1==this.opened&&(this.reCompose(),a.O.each(this.derivatives,function(a){a.close()}));this.opened--},reCompose:function(){this.composeFrom()},deCompose:function(){this.eachOwn(function(a,b){a.definedIn!=this&&this.removeProperty(b)},this)}})).c;a.Managed.StemElement=function(){throw"Modules may not be instantiated.";};a.Managed.StemElement.Attributes=(new a.Proto.Class("Joose.Managed.StemElement.Attributes",{isa:a.Managed.PropertySet.Mutable,propertyMetaClass:a.Managed.Property.Attribute})).c;
a.Managed.StemElement.Methods=(new a.Proto.Class("Joose.Managed.StemElement.Methods",{isa:a.Managed.PropertySet.Mutable,propertyMetaClass:a.Managed.Property.MethodModifier.Put,preApply:function(){},postUnApply:function(){}})).c;a.Managed.StemElement.Requirements=(new a.Proto.Class("Joose.Managed.StemElement.Requirements",{isa:a.Managed.PropertySet.Mutable,propertyMetaClass:a.Managed.Property.Requirement,alias:function(){},exclude:function(){},flattenTo:function(a){this.each(function(b,c){a.haveProperty(c)||
a.addPropertyObject(b)})},composeTo:function(a){this.flattenTo(a)},preApply:function(){},postUnApply:function(){}})).c;a.Managed.StemElement.MethodModifiers=(new a.Proto.Class("Joose.Managed.StemElement.MethodModifiers",{isa:a.Managed.PropertySet.Mutable,propertyMetaClass:null,addProperty:function(a,b){var c=b.meta;delete b.meta;b.definedIn=this;b.name=a;var c=new c(b),d=this.properties;d[a]||(d[a]=[]);d[a].push(c);return c},addPropertyObject:function(a){var b=a.name,c=this.properties;c[b]||(c[b]=
[]);c[b].push(a);return a},removeProperty:function(b){if(this.haveProperty(b)){var c=this.properties,d=c[b].pop();c[b].length||a.Managed.StemElement.MethodModifiers.superClass.removeProperty.call(this,b);return d}},alias:function(){},exclude:function(){},flattenTo:function(b){var c=b.properties;this.each(function(b,d){var h=c[d];null==h&&(h=c[d]=[]);a.A.each(b,function(b){a.A.exists(h,b)||h.push(b)})})},composeTo:function(a){this.flattenTo(a)},deCompose:function(){this.each(function(a,b){for(var c=
0;c<a.length;)a[c].definedIn!=this?a.splice(c,1):c++})},preApply:function(a){},postUnApply:function(a){},apply:function(b){this.each(function(c,d){a.A.each(c,function(a){a.apply(b)})})},unapply:function(a){this.each(function(b,c){for(var d=b.length-1;0<=d;d--)b[d].unapply(a)})}})).c;a.Managed.PropertySet.Composition=(new a.Proto.Class("Joose.Managed.PropertySet.Composition",{isa:a.Managed.PropertySet.Mutable,propertyMetaClass:a.Managed.PropertySet.Mutable,processOrder:null,each:function(b,c){var d=
this.properties;c=c||this;a.A.each(this.processOrder,function(a){b.call(c,d[a],a)})},eachR:function(b,c){var d=this.properties;c=c||this;a.A.eachR(this.processOrder,function(a){b.call(c,d[a],a)})},clone:function(a){var b=this.cleanClone(a);this.each(function(a){b.addPropertyObject(a.clone())});return b},alias:function(a){this.each(function(b){b.alias(a)})},exclude:function(a){this.each(function(b){b.exclude(a)})},flattenTo:function(a){var b=a.properties;this.each(function(c,d){var e=b[d]||a.addProperty(d,
{meta:c.constructor});c.flattenTo(e)})},composeTo:function(a){var b=a.properties;this.each(function(c,d){var e=b[d]||a.addProperty(d,{meta:c.constructor});c.composeTo(e)})},deCompose:function(){this.eachR(function(a){a.open()});a.Managed.PropertySet.Composition.superClass.deCompose.call(this)},reCompose:function(){a.Managed.PropertySet.Composition.superClass.reCompose.call(this);this.each(function(a){a.close()})},unapply:function(a){this.eachR(function(b){b.unapply(a)})}})).c;a.Managed.Stem=(new a.Proto.Class("Joose.Managed.Stem",
{isa:a.Managed.PropertySet.Composition,targetMeta:null,attributesMC:a.Managed.StemElement.Attributes,methodsMC:a.Managed.StemElement.Methods,requirementsMC:a.Managed.StemElement.Requirements,methodsModifiersMC:a.Managed.StemElement.MethodModifiers,processOrder:["attributes","methods","requirements","methodsModifiers"],initialize:function(b){a.Managed.Stem.superClass.initialize.call(this,b);b=this.targetMeta;this.addProperty("attributes",{meta:this.attributesMC,properties:b?b.attributes:{}});this.addProperty("methods",
{meta:this.methodsMC,properties:b?b.methods:{}});this.addProperty("requirements",{meta:this.requirementsMC});this.addProperty("methodsModifiers",{meta:this.methodsModifiersMC})},reCompose:function(){var b=this.targetMeta.c;this.preApply(b);a.Managed.Stem.superClass.reCompose.call(this);this.apply(b)},deCompose:function(){var b=this.targetMeta.c;this.unapply(b);a.Managed.Stem.superClass.deCompose.call(this);this.postUnApply(b)}})).c;a.Managed.Builder=(new a.Proto.Class("Joose.Managed.Builder",{targetMeta:null,
_buildStart:function(b,c){b.stem.open();a.A.each("trait traits removeTrait removeTraits does doesnot doesnt".split(" "),function(a){c[a]&&(this[a](b,c[a]),delete c[a])},this)},_extend:function(b){if(!a.O.isEmpty(b)){var c=this.targetMeta;this._buildStart(c,b);a.O.eachOwn(b,function(a,b){var d=this[b];if(!d)throw Error("Unknown builder ["+b+"] was used during extending of ["+c.c+"]");d.call(this,c,a)},this);this._buildComplete(c,b)}},_buildComplete:function(a,b){a.stem.close()},methods:function(b,
c){a.O.eachOwn(c,function(a,c){b.addMethod(c,a)})},removeMethods:function(b,c){a.A.each(c,function(a){b.removeMethod(a)})},have:function(b,c){a.O.eachOwn(c,function(a,c){b.addAttribute(c,a)})},havenot:function(b,c){a.A.each(c,function(a){b.removeAttribute(a)})},havent:function(a,b){this.havenot(a,b)},after:function(b,c){a.O.each(c,function(c,d){b.addMethodModifier(d,c,a.Managed.Property.MethodModifier.After)})},before:function(b,c){a.O.each(c,function(c,d){b.addMethodModifier(d,c,a.Managed.Property.MethodModifier.Before)})},
override:function(b,c){a.O.each(c,function(c,d){b.addMethodModifier(d,c,a.Managed.Property.MethodModifier.Override)})},around:function(b,c){a.O.each(c,function(c,d){b.addMethodModifier(d,c,a.Managed.Property.MethodModifier.Around)})},augment:function(b,c){a.O.each(c,function(c,d){b.addMethodModifier(d,c,a.Managed.Property.MethodModifier.Augment)})},removeModifier:function(b,c){a.A.each(c,function(a){b.removeMethodModifier(a)})},does:function(b,c){a.A.each(a.O.wantArray(c),function(a){b.addRole(a)})},
doesnot:function(b,c){a.A.each(a.O.wantArray(c),function(a){b.removeRole(a)})},doesnt:function(a,b){this.doesnot(a,b)},trait:function(){this.traits.apply(this,arguments)},traits:function(a,b){if(!a.firstPass){if(!a.meta.isDetached)throw"Can't apply trait to not detached class";a.meta.extend({does:b})}},removeTrait:function(){this.removeTraits.apply(this,arguments)},removeTraits:function(a,b){if(!a.meta.isDetached)throw"Can't remove trait from not detached class";a.meta.extend({doesnot:b})},name:function(a,
b){a.name=b}})).c;a.Managed.Class=(new a.Proto.Class("Joose.Managed.Class",{isa:a.Proto.Class,stem:null,stemClass:a.Managed.Stem,stemClassCreated:!1,builder:null,builderClass:a.Managed.Builder,builderClassCreated:!1,isDetached:!1,firstPass:!0,skipTraitsAnchor:{},BUILD:function(){var b=a.Managed.Class.superClass.BUILD.apply(this,arguments),c=b.__extend__,d=a.O.wantArray(c.trait||c.traits||[]);delete c.trait;delete c.traits;a.A.each(a.O.wantArray(c.does||[]),function(b){b=b.meta instanceof a.Managed.Class?
b:b.role;b.meta.meta.isDetached&&d.push(b.meta.constructor)});d.length&&(c.traits=d);return b},initInstance:function(b,c){a.O.each(this.attributes,function(d,e){d instanceof a.Managed.Attribute?d.initFromConfig(b,c):c.hasOwnProperty(e)&&(b[e]=c[e])})},defaultConstructor:function(){return function(a,b){var c=this.meta,d=a==c.skipTraitsAnchor,e=this.BUILD,e=e&&e.apply(this,d?b:arguments)||(d?b[0]:a)||{},f=e.__extend__||e,g=f.trait||f.traits;if(g||f.detached)if(delete f.trait,delete f.traits,delete f.detached,
!d)return d=c.subClass({does:g||[]},c.name).meta,d.isDetached=!0,d.instantiate(c.skipTraitsAnchor,arguments);c.initInstance(this,e);return c.hasMethod("initialize")&&this.initialize(e)||this}},finalize:function(b){a.Managed.Class.superClass.finalize.call(this,b);this.stem.close();this.afterMutate()},processStem:function(){a.Managed.Class.superClass.processStem.call(this);this.builder=new this.builderClass({targetMeta:this});this.stem=new this.stemClass({name:this.name,targetMeta:this});var b=this.getClassInAttribute("builderClass");
b&&(this.builderClassCreated=!0,this.addAttribute("builderClass",this.subClassOf(b)));if(b=this.getClassInAttribute("stemClass"))this.stemClassCreated=!0,this.addAttribute("stemClass",this.subClassOf(b))},extend:function(a){a.builder&&(this.getBuilderTarget().meta.extend(a.builder),delete a.builder);a.stem&&(this.getStemTarget().meta.extend(a.stem),delete a.stem);this.builder._extend(a);this.firstPass=!1;this.stem.opened||this.afterMutate()},getBuilderTarget:function(){var a=this.getClassInAttribute("builderClass");
if(!a)throw"Attempt to extend a builder on non-meta class";return a},getStemTarget:function(){var a=this.getClassInAttribute("stemClass");if(!a)throw"Attempt to extend a stem on non-meta class";return a},getClassInAttribute:function(b){b=this.getAttribute(b);b instanceof a.Managed.Property.Attribute&&(b=b.value);return b},addMethodModifier:function(a,b,c){var d={};d.init=b;d.meta=c;return this.stem.properties.methodsModifiers.addProperty(a,d)},removeMethodModifier:function(a){return this.stem.properties.methodsModifiers.removeProperty(a)},
addMethod:function(a,b,c){c=c||{};c.init=b;return this.stem.properties.methods.addProperty(a,c)},addAttribute:function(a,b,c){c=c||{};c.init=b;return this.stem.properties.attributes.addProperty(a,c)},removeMethod:function(a){return this.stem.properties.methods.removeProperty(a)},removeAttribute:function(a){return this.stem.properties.attributes.removeProperty(a)},hasMethod:function(a){return this.stem.properties.methods.haveProperty(a)},hasAttribute:function(a){return this.stem.properties.attributes.haveProperty(a)},
hasMethodModifiersFor:function(a){return this.stem.properties.methodsModifiers.haveProperty(a)},hasOwnMethod:function(a){return this.stem.properties.methods.haveOwnProperty(a)},hasOwnAttribute:function(a){return this.stem.properties.attributes.haveOwnProperty(a)},getMethod:function(a){return this.stem.properties.methods.getProperty(a)},getAttribute:function(a){return this.stem.properties.attributes.getProperty(a)},eachRole:function(b,c,d){a.A.each(b,function(b,e){c.call(d||this,b,b.meta instanceof
a.Managed.Class?b:b.role,e)},this)},addRole:function(){this.eachRole(arguments,function(a,b){this.beforeRoleAdd(b);var c=a;b!=a?(c.propertySet=b.meta.stem,delete c.role):c=c.meta.stem;this.stem.addComposeInfo(c)},this)},beforeRoleAdd:function(a){a=a.meta;a.builderClassCreated&&this.getBuilderTarget().meta.extend({does:[a.getBuilderTarget()]});a.stemClassCreated&&this.getStemTarget().meta.extend({does:[a.getStemTarget()]});a.meta.isDetached&&!this.firstPass&&this.builder.traits(this,a.constructor)},
beforeRoleRemove:function(a){a=a.meta;a.builderClassCreated&&this.getBuilderTarget().meta.extend({doesnt:[a.getBuilderTarget()]});a.stemClassCreated&&this.getStemTarget().meta.extend({doesnt:[a.getStemTarget()]});a.meta.isDetached&&!this.firstPass&&this.builder.removeTraits(this,a.constructor)},removeRole:function(){this.eachRole(arguments,function(a,b){this.beforeRoleRemove(b);this.stem.removeComposeInfo(b.meta.stem)},this)},getRoles:function(){return a.A.map(this.stem.composedFrom,function(b){return b instanceof
a.Managed.PropertySet?b.targetMeta.c:b.propertySet})},does:function(b){for(var c=this.getRoles(),d=0;d<c.length;d++)if(b==c[d])return!0;for(d=0;d<c.length;d++)if(c[d].meta.does(b))return!0;c=this.superClass.meta;return this.superClass!=a.Proto.Empty&&c&&c.meta&&c.meta.hasMethod("does")?c.does(b):!1},getMethods:function(){return this.stem.properties.methods},getAttributes:function(){return this.stem.properties.attributes},afterMutate:function(){},getCurrentMethod:function(){for(var a=arguments.callee.caller,
b=0;a&&5>b;a=a.caller,b++)if(a.__METHOD__)return a.__METHOD__;return null}})).c;a.Managed.Role=(new a.Managed.Class("Joose.Managed.Role",{isa:a.Managed.Class,have:{defaultSuperClass:a.Proto.Empty,builderRole:null,stemRole:null},methods:{defaultConstructor:function(){return function(){throw Error("Roles cant be instantiated");}},processSuperClass:function(){if(this.superClass!=this.defaultSuperClass)throw Error("Roles can't inherit from anything");},getBuilderTarget:function(){this.builderRole||(this.builderRole=
(new this.constructor).c,this.builderClassCreated=!0);return this.builderRole},getStemTarget:function(){this.stemRole||(this.stemRole=(new this.constructor).c,this.stemClassCreated=!0);return this.stemRole},addRequirement:function(a){this.stem.properties.requirements.addProperty(a,{})}},stem:{methods:{apply:function(){},unapply:function(){}}},builder:{methods:{requires:function(b,c){a.A.each(a.O.wantArray(c),function(a){b.addRequirement(a)},this)}}}})).c;a.Managed.Attribute=(new a.Managed.Class("Joose.Managed.Attribute",
{isa:a.Managed.Property.Attribute,have:{is:null,builder:null,isPrivate:!1,role:null,publicName:null,setterName:null,getterName:null,readable:!1,writeable:!1,hasGetter:!1,hasSetter:!1,required:!1,canInlineSetRaw:!0,canInlineGetRaw:!0},after:{initialize:function(){var a=this.name;this.publicName=a.replace(/^_+/,"");this.slot=this.isPrivate?"$"+a:a;this.setterName=this.setterName||this.getSetterName();this.getterName=this.getterName||this.getGetterName();this.readable=this.hasGetter=/^r/i.test(this.is);
this.writeable=this.hasSetter=/^.w/i.test(this.is)}},override:{computeValue:function(){var b=this.init;!a.O.isClass(b)&&a.O.isFunction(b)||this.SUPER()},preApply:function(a){a.meta.extend({methods:this.getAccessorsFor(a)})},postUnApply:function(a){a.meta.extend({removeMethods:this.getAccessorsFrom(a)})}},methods:{getAccessorsFor:function(a){a=a.meta;var b=this.setterName,c=this.getterName,d={};this.hasSetter&&!a.hasMethod(b)&&(d[b]=this.getSetter(),d[b].ACCESSOR_FROM=this);this.hasGetter&&!a.hasMethod(c)&&
(d[c]=this.getGetter(),d[c].ACCESSOR_FROM=this);return d},getAccessorsFrom:function(a){var b=a.meta;a=this.setterName;var c=this.getterName,d=this.hasSetter&&b.getMethod(a),b=this.hasGetter&&b.getMethod(c),e=[];d&&d.value.ACCESSOR_FROM==this&&e.push(a);b&&b.value.ACCESSOR_FROM==this&&e.push(c);return e},getGetterName:function(){return"get"+a.S.uppercaseFirst(this.publicName)},getSetterName:function(){return"set"+a.S.uppercaseFirst(this.publicName)},getSetter:function(){var a=this,b=a.slot;return a.canInlineSetRaw?
function(a){this[b]=a;return this}:function(){return a.setRawValueTo.apply(this,arguments)}},getGetter:function(){var a=this,b=a.slot;return a.canInlineGetRaw?function(a){return this[b]}:function(){return a.getRawValueFrom.apply(this,arguments)}},getValueFrom:function(a){var b=this.getterName;return this.readable&&a.meta.hasMethod(b)?a[b]():this.getRawValueFrom(a)},setValueTo:function(a,b){var c=this.setterName;if(this.writeable&&a.meta.hasMethod(c))a[c](b);else this.setRawValueTo(a,b)},initFromConfig:function(b,
c){var d=this.name,e,f=!1;if(c.hasOwnProperty(d))e=c[d],f=!0;else{var g=this.init;a.O.isFunction(g)&&!a.O.isClass(g)?(e=g.call(b,c,d),f=!0):this.builder&&(e=b[this.builder.replace(/^this\./,"")](c,d),f=!0)}if(f)this.setRawValueTo(b,e);else if(this.required)throw Error("Required attribute ["+d+"] is missed during initialization of "+b);}}})).c;a.Managed.Attribute.Builder=(new a.Managed.Role("Joose.Managed.Attribute.Builder",{have:{defaultAttributeClass:a.Managed.Attribute},builder:{methods:{has:function(b,
c){a.O.eachOwn(c,function(a,c){if("object"!=typeof a||null==a||a.constructor==/ /.constructor)a={init:a};a.meta=a.meta||b.defaultAttributeClass;/^__/.test(c)&&(c=c.replace(/^_+/,""),a.isPrivate=!0);b.addAttribute(c,a.init,a)},this)},hasnot:function(a,b){this.havenot(a,b)},hasnt:function(a,b){this.hasnot(a,b)}}}})).c;a.Managed.My=(new a.Managed.Role("Joose.Managed.My",{have:{myClass:null,needToReAlias:!1},methods:{createMy:function(b){var c=this instanceof a.Managed.Role,d=b.my||{};delete b.my;b=this.superClass.meta.myClass;
c||(d.isa||!b)||(d.isa=b);d.meta||d.isa||(d.meta=this.constructor);d.name=this.name+".my";d=this.myClass=g(d);b=this.c;b.prototype.my=b.my=c?d:new d({HOST:b});this.needToReAlias=!0},aliasStaticMethods:function(){this.needToReAlias=!1;var b=this.c,c=this.myClass.prototype;a.O.eachOwn(b,function(a,c){a.IS_ALIAS&&delete b[c]});this.myClass.meta.stem.properties.methods.each(function(a,d){b[d]||((b[d]=function(){return c[d].apply(b.my,arguments)}).IS_ALIAS=!0)})}},override:{extend:function(b){var c=this.myClass;
!c&&this.superClass.meta.myClass&&this.createMy(b);b.my&&(c?(this.needToReAlias=!0,c.meta.extend(b.my),delete b.my):this.createMy(b));this.SUPER(b);!this.needToReAlias||this instanceof a.Managed.Role||this.aliasStaticMethods()}},before:{addRole:function(){var b;a.A.each(arguments,function(c){if(!c)throw Error("Attempt to consume an undefined Role into ["+this.name+"]");c=c.meta instanceof a.Managed.Class?c:c.role;c.meta.meta.hasAttribute("myClass")&&c.meta.myClass&&(this.myClass?(b=this.myClass.meta.stem,
b.opened||b.open(),b.addComposeInfo(c.my.meta.stem)):this.createMy({my:{does:c.meta.myClass}}))},this);b&&(b.close(),this.needToReAlias=!0)},removeRole:function(){if(this.myClass){var b=this.myClass.meta.stem;b.open();a.A.each(arguments,function(a){a.meta.meta.hasAttribute("myClass")&&a.meta.myClass&&(b.removeComposeInfo(a.my.meta.stem),this.needToReAlias=!0)},this);b.close()}}}})).c;a.Namespace=a.stub();a.Namespace.Able=(new a.Managed.Role("Joose.Namespace.Able",{have:{bodyFunc:null},before:{extend:function(a){a.body&&
(this.bodyFunc=a.body,delete a.body)}},after:{afterMutate:function(){var b=this.bodyFunc;delete this.bodyFunc;b&&a.Namespace.Manager.my.executeIn(this.c,b)}}})).c;a.Managed.Bootstrap=(new a.Managed.Role("Joose.Managed.Bootstrap",{does:[a.Namespace.Able,a.Managed.My,a.Managed.Attribute.Builder]})).c;a.Meta=a.stub();a.Meta.Object=(new a.Proto.Class("Joose.Meta.Object",{isa:a.Proto.Object})).c;a.Meta.Class=(new a.Managed.Class("Joose.Meta.Class",{isa:a.Managed.Class,does:a.Managed.Bootstrap,have:{defaultSuperClass:a.Meta.Object}})).c;
a.Meta.Role=(new a.Meta.Class("Joose.Meta.Role",{isa:a.Managed.Role,does:a.Managed.Bootstrap})).c;a.Namespace.Keeper=(new a.Meta.Class("Joose.Namespace.Keeper",{isa:a.Meta.Class,have:{externalConstructor:null},methods:{defaultConstructor:function(){return function(){var b=arguments.callee.meta;if(b instanceof a.Namespace.Keeper)throw Error("Module ["+b.c+"] may not be instantiated. Forgot to 'use' the class with the same name?");var c=b.externalConstructor;if("function"==typeof c)return c.meta=b,
c.apply(this,arguments);throw"NamespaceKeeper of ["+b.name+"] was planted incorrectly.";}},plant:function(a){var b=this.c;b.meta=a.meta;b.meta.c=b;b.meta.externalConstructor=a}}})).c;a.Namespace.Manager=(new a.Managed.Class("Joose.Namespace.Manager",{have:{current:null},methods:{initialize:function(){this.current=[a.top]},getCurrent:function(){return this.current[0]},executeIn:function(a,b){var c=this.current;c.unshift(a);var d=b.call(a,a);c.shift();return d},earlyCreate:function(a,b,c){c.constructorOnly=
!0;return(new b(a,c)).c},create:function(b,c,d){if(!b)return(new c(b,d)).c;var e=this;if(/^\./.test(b))return this.executeIn(a.top,function(){return e.create(b.replace(/^\./,""),c,d)});for(var f=d||{},g=a.S.saneSplit(b,"."),l=this.getCurrent(),t=l==a.top?[]:a.S.saneSplit(l.meta.name,"."),p=0;p<g.length;p++){var q=g[p],n=p==g.length-1;if("meta"==q||"my"==q||!q)throw"Module name ["+b+"] may not include a part called 'meta' or 'my' or empty part.";var u=l[q];t.push(q);var w=t.join("."),x=!1;if("undefined"==
typeof u)n?(u=this.earlyCreate(w,c,f),x=!0):u=(new a.Namespace.Keeper(w)).c,l[q]=u;else if(n&&u&&u.meta)if(l=u.meta,c==a.Namespace.Keeper)l.extend(f);else if(l instanceof a.Namespace.Keeper)l.plant(this.earlyCreate(w,c,f)),x=!0;else throw Error("Double declaration of ["+w+"]");else if(n&&!(u&&u.meta&&u.meta.meta))throw"Trying to setup module "+w+" failed. There is already something: "+u;n&&this.prepareMeta(u.meta);x&&u.meta.construct(f);l=u}return l},prepareMeta:function(){},prepareProperties:function(a,
b,c,d){a&&"string"!=typeof a&&(b=a,a=null);var e;b&&b.meta&&(e=b.meta,delete b.meta);e||(e=b&&"function"==typeof b.isa&&b.isa.meta?b.isa.meta.constructor:c);return d.call(this,a,e,b)},getDefaultHelperFor:function(a){var b=this;return function(c,d){return b.prepareProperties(c,d,a,function(a,c,d){return b.create(a,c,d)})}},register:function(b,c,d){var e=this;if(this.meta.hasMethod(b))c=function(){return e[b].apply(e,arguments)},a.top[b]||(a.top[b]=c),a[b]||(a[b]=c),a.is_NodeJS&&"undefined"!=typeof exports&&
(exports[b]=c);else{var f={};f[b]=d||this.getDefaultHelperFor(c);this.meta.extend({methods:f});this.register(b)}},Module:function(b,c){return this.prepareProperties(b,c,a.Namespace.Keeper,function(a,b,c){"function"==typeof c&&(c={body:c});return this.create(a,b,c)})}}})).c;a.Namespace.Manager.my=new a.Namespace.Manager;a.Namespace.Manager.my.register("Class",a.Meta.Class);a.Namespace.Manager.my.register("Role",a.Meta.Role);a.Namespace.Manager.my.register("Module");var g=a.Class;e=a.Role;e("Joose.Attribute.Delegate",
{have:{handles:null},override:{eachDelegate:function(b,c,d){if("string"==typeof b)return c.call(d,b,b);if(b instanceof Array)return a.A.each(b,function(a){c.call(d,a,a)});b===Object(b)&&a.O.eachOwn(b,function(a,b){c.call(d,b,a)})},getAccessorsFor:function(a){var b=a.meta,c=this.SUPER(a),d=this;this.eachDelegate(this.handles,function(a,e){b.hasMethod(a)||((c[a]=function(){var a=d.getValueFrom(this);return a[e].apply(a,arguments)}).ACCESSOR_FROM=d)});return c},getAccessorsFrom:function(a){var b=this.SUPER(a),
c=this,d=a.meta;this.eachDelegate(this.handles,function(a){var e=d.getMethod(a);e&&e.value.ACCESSOR_FROM==c&&b.push(a)});return b}}});e("Joose.Attribute.Trigger",{have:{trigger:null},after:{initialize:function(){if(this.trigger){if(!this.writeable)throw Error("Can't use `trigger` for read-only attributes");this.hasSetter=!0}}},override:{getSetter:function(){var b=this.SUPER(),c=this.trigger;if(!c)return b;var d=this,e=a.O.isFunction(d.init)?null:d.init;return function(){var a=d.hasValue(this)?d.getValueFrom(this):
e,f=b.apply(this,arguments);c.call(this,d.getValueFrom(this),a);return f}}}});e("Joose.Attribute.Lazy",{have:{lazy:null},before:{computeValue:function(){"function"==typeof this.init&&this.lazy&&(this.lazy=this.init,delete this.init)}},after:{initialize:function(){this.lazy&&(this.readable=this.hasGetter=!0)}},override:{getGetter:function(){var a=this.SUPER(),b=this.lazy;if(!b)return a;var c=this;return function(){if(!c.hasValue(this)){var d="function"==typeof b?b:this[b.replace(/^this\./,"")];c.setValueTo(this,
d.apply(this,arguments))}return a.call(this)}}}});e("Joose.Attribute.Accessor.Combined",{have:{isCombined:!1},after:{initialize:function(){if(this.isCombined=this.isCombined||/..c/i.test(this.is))this.slot="$$"+this.name,this.hasGetter=!0,this.hasSetter=!1,this.setterName=this.getterName=this.publicName}},override:{getGetter:function(){var a=this.SUPER();if(!this.isCombined)return a;var b=this.getSetter(),c=this;return function(){if(!arguments.length){if(c.readable)return a.call(this);throw Error("Call to getter of unreadable attribute: ["+
c.name+"]");}if(c.writeable)return b.apply(this,arguments);throw Error("Call to setter of read-only attribute: ["+c.name+"]");}}}});a.Managed.Attribute.meta.extend({does:[a.Attribute.Delegate,a.Attribute.Trigger,a.Attribute.Lazy,a.Attribute.Accessor.Combined]});e("Joose.Meta.Singleton",{has:{forceInstance:a.I.Object,instance:null},override:{defaultConstructor:function(){var a=this,b=this.SUPER();this.adaptConstructor(b);return function(c,d){if(c==a.forceInstance)return b.apply(this,d)||this;var e=
a.instance;e?a.hasMethod("configure")&&e.configure.apply(e,arguments):a.instance=new a.c(a.forceInstance,arguments);return a.instance}}}});a.Namespace.Manager.my.register("Singleton",g({isa:a.Meta.Class,meta:a.Meta.Class,does:a.Meta.Singleton}))}();
Class("Scope.Provider",{VERSION:0.12,has:{name:null,scope:null,seedingCode:null,seedingScript:null,preload:{is:"ro",init:Joose.I.Array},cleanupCallback:null,beforeCleanupCallback:null},methods:{isCSS:function(a){return/\.css(\?.*)?$/i.test(a)},isAlreadySetUp:function(){return Boolean(this.scope)},addPreload:function(a){if(this.isAlreadySetUp())throw Error("Can't use `addPreload` - scope is already setup. Use `runCode/runScript` instead");"string"==typeof a?a=this.isCSS(a)?{type:"css",url:a}:{type:"js",
url:a}:a.text&&(a={type:"js",content:a.text});if(!a.type)throw Error("Preload descriptor must have the `type` property");this.preload.push(a)},addOnErrorHandler:function(a,b){throw"Abstract method `addOnErrorHandler` of Scope.Provider called";},create:function(){throw"Abstract method `create` of Scope.Provider called";},setup:function(a){throw"Abstract method `setup` of Scope.Provider called";},cleanup:function(a){throw"Abstract method `cleanup` of Scope.Provider called";},runCode:function(a,b){throw"Abstract method `runCode` of Scope.Provider called";
},runScript:function(a,b){throw"Abstract method `runScript` of Scope.Provider called";}}});Scope.Provider.__ONLOAD__={};Scope.Provider.__ONERROR__={};
Role("Scope.Provider.Role.WithDOM",{requires:["getDocument","create","getPreload","isAlreadySetUp","setViewportSize"],has:{useStrictMode:!0,sourceURL:null,minViewportSize:null,parentWindow:function(){return window},scopeId:function(){return Math.round(1E10*Math.random())},attachToOnError:function(){return function(a,b,c,d){var e=a.onerror;e&&e.__SP_MANAGED__||(a.onerror=function(f,g,h){c=(a.opener||a.parent).Scope.Provider.__ONERROR__[b];if(!c.__CALLING__&&(c.__CALLING__=!0,e&&e.apply(this,arguments),
c.apply(this,arguments),c.__CALLING__=!1,!1!==d))return a.WebKitPoint?!1:!0},a.onerror.__SP_MANAGED__=!0)}},cachedOnError:null},override:{cleanup:function(){this.cachedOnError=null;try{this.scope.onerror=null}catch(a){}this.SUPERARG(arguments);this.scope=null}},methods:{cleanupHanlders:function(){var a=this.parentWindow.Scope.Provider;delete a.__ONLOAD__[this.scopeId];delete a.__ONERROR__[this.scopeId]},getHead:function(){return this.getDocument().getElementsByTagName("head")[0]},installOnErrorHandler:function(a){if(!this.isAlreadySetUp())throw"Scope should be already set up";
this.attachToOnError(this.scope,this.scopeId,a)},addOnErrorHandler:function(a,b){a.__SP_MANAGED__=!0;this.cachedOnError=a;var c=this.scopeId;this.parentWindow.Scope.Provider.__ONERROR__[c]=a;c=";("+this.attachToOnError.toString()+")(window, "+c+", (window.opener || window.parent).Scope.Provider.__ONERROR__[ "+c+" ], "+b+");";this.isAlreadySetUp()?this.runCode(c):this.getPreload().unshift({type:"js",content:c,unordered:!0})},addSeedingToPreload:function(){var a=this.getPreload();this.seedingCode&&
a.unshift({type:"js",content:this.seedingCode});this.seedingScript&&a.push({type:"js",url:this.seedingScript})},setup:function(a){var b="v"=="\v"||Boolean(this.parentWindow.msWriteProfilerMark),c=!1;Joose.A.each(this.getPreload(),function(a){if("js"==a.type&&a.content&&!a.unordered)return c=!0,!1});this.sourceURL||b&&c?(this.addSeedingToPreload(),this.setupIncrementally(a)):(b||this.addSeedingToPreload(),this.setupWithDocWrite(a,b))},setupWithDocWrite:function(a,b){var c=[],d=this;Joose.A.each(this.getPreload(),
function(a){if("js"==a.type)c.push(d.getScriptTagString(a.url,a.content));else if("css"==a.type)c.push(d.getLinkTagString(a.url,a.content));else throw"Incorrect preload descriptor "+a;});this.create();var e=this.scopeId;this.parentWindow.Scope.Provider.__ONLOAD__[e]=function(){var c=function(){a&&a(d)};b?(d.seedingCode&&d.runCode(d.seedingCode),d.seedingScript?d.runScript(d.seedingScript,c):c()):c()};var f=this.getDocument();f.open();f.write([this.useStrictMode?"<!DOCTYPE html>":"",'<html style="width: 100%; height: 100%; margin : 0; padding : 0;"><head>',
c.join(""),"</head>",'<body style="margin : 0; padding : 0; width: 100%; height: 100%" onload="(window.opener || window.parent).Scope.Provider.__ONLOAD__['+e+']()">',"</body></html>"].join(""));f.close();d.cachedOnError&&d.installOnErrorHandler(d.cachedOnError)},setupIncrementally:function(a){var b=this;this.create(function(){var c=function(a,e){var f=function(){c(a,e)};if(a.length){var g=a.shift();g.url?b.runScript(g.url,f):"js"==g.type?b.runCode(g.content,f):(b.addStyleTag(g.content),f())}else e&&
e()};c(b.getPreload().slice(),a)})},getScriptTagString:function(a,b){var c='<script type="text/javascript"';return c=a?c+(' src="'+a+'">\x3c/script>'):c+(">"+b.replace(/<\/script>/gi,"\\x3C/script>")+"\x3c/script>")},getLinkTagString:function(a,b){if(a)return'<link href="'+a+'" rel="stylesheet" type="text/css" />';if(b)return"<style>"+b+"</style>"},loadCSS:function(a,b){var c=this.getDocument(),d=c.createElement("link");d.type="text/css";d.rel="stylesheet";d.href=a;this.getHead().appendChild(d);var e=
!1,d=function(){e||(e=!0,clearTimeout(f),b&&b(),c.body.removeChild(g))},f=setTimeout(d,3E3),g=c.createElement("img");g.onerror=d;c.body.appendChild(g);g.src=a},runCode:function(a,b){this.getHead().appendChild(this.createScriptTag(a));b&&b()},runScript:function(a,b){this.isCSS(a)?this.loadCSS(a,b):this.getHead().appendChild(this.createScriptTag(null,a,b))},createScriptTag:function(a,b,c){var d=this.getDocument().createElement("script");d.setAttribute("type","text/javascript");b&&d.setAttribute("src",
b);a&&(d.text=a);c&&(d.onload=d.onreadystatechange=function(){if(!d.readyState||"loaded"==d.readyState||"complete"==d.readyState||4==d.readyState&&200==d.status)d.onload=d.onreadystatechange=null,"v"=="\v"?setTimeout(c,0):c()});return d},addStyleTag:function(a){var b=this.getDocument(),c=b.createElement("style");c.setAttribute("type","text/css");b.getElementsByTagName("head")[0].appendChild(c);c.styleSheet?c.styleSheet.cssText=a:c.appendChild(b.createTextNode(a))}}});
Class("Scope.Provider.IFrame",{isa:Scope.Provider,does:Scope.Provider.Role.WithDOM,have:{iframe:null,cls:null,performWrap:!1,wrapCls:null,wrapper:null,parentEl:null,cleanupDelay:1E3},methods:{getDocument:function(){return this.iframe.contentWindow.document},setViewportSize:function(a,b){var c=this.iframe;c&&(c.style.width=a+"px",c.style.height=b+"px")},create:function(a){var b=this,c=this.parentWindow.document,d=this.iframe=c.createElement("iframe"),e=this.minViewportSize;d.className=this.cls||"";
d.style.width=(e&&e.width||1024)+"px";d.style.height=(e&&e.height||768)+"px";d.setAttribute("frameborder",0);this.name&&d.setAttribute("name",this.name);var f=!1,g=function(){f||(d.detachEvent?d.detachEvent("onload",g):d.onload=null,a&&a(b))};d.attachEvent?d.attachEvent("onload",g):d.onload=g;d.src=this.sourceURL||"about:blank";if(this.performWrap){var h=this.wrapper=this.wrapper||c.createElement("div");h.className=this.wrapCls||"";h.appendChild(d)}(this.parentEl||c.body).appendChild(h||d);var k=
this.scope=d.contentWindow,c=this.getDocument();if("v"=="\v"||Boolean(this.parentWindow.msWriteProfilerMark))this.sourceURL&&(f=!0),c.open(),c.write(""),c.close(),f=!1,d.onreadystatechange=function(){"complete"==d.readyState&&(d.onreadystatechange=null);b.cachedOnError&&b.attachToOnError(k,b.scopeId,b.cachedOnError)},this.sourceURL&&(d.src=this.sourceURL);b.cachedOnError&&b.installOnErrorHandler(b.cachedOnError)},cleanup:function(){var a=this.wrapper||this.iframe,b=this.iframe,c=this;a.style.display=
"none";this.runCode(";("+function(){window.onunload||(window.onunload=function(){return"something"})}.toString()+")();");this.wrapper=this.scope=this.iframe=null;setTimeout(function(){c.beforeCleanupCallback&&c.beforeCleanupCallback();c.beforeCleanupCallback=null;b.src="javascript:false";setTimeout(function(){(c.parentEl||c.parentWindow.document.body).removeChild(a);b=a=null;c.parentEl=null;c.cleanupHanlders();c.cleanupCallback&&c.cleanupCallback();c.cleanupCallback=null},c.cleanupDelay)},c.cleanupDelay)}}});
Class("Scope.Provider.Window",{isa:Scope.Provider,does:Scope.Provider.Role.WithDOM,has:{popupWindow:null},methods:{setViewportSize:function(a,b){var c=this.popupWindow;c&&c.resizeTo(a,b)},create:function(a){var b=this.minViewportSize,c=this.scope=this.popupWindow=this.parentWindow.open(this.sourceURL||"about:blank","_blank","left=10,top=10,width="+(b&&b.width||1024)+",height="+(b&&b.height||768));if(!c)throw alert("Please enable popups for the host with this test suite running: "+this.parentWindow.location.host),
"Please enable popups for the host with this test suite running: "+this.parentWindow.location.host;"v"!="\v"&&!Boolean(this.parentWindow.msWriteProfilerMark)||this.sourceURL||(b=this.getDocument(),b.open(),b.write(""),b.close());this.cachedOnError&&this.installOnErrorHandler(this.cachedOnError);var d=function(a,b){var c=!1,d=!0,k=a.document,m=k.documentElement,r=k.addEventListener?"addEventListener":"attachEvent",s=k.addEventListener?"removeEventListener":"detachEvent",v=k.addEventListener?"":"on",
l=function(d){if("readystatechange"!=d.type||"complete"==k.readyState)("load"==d.type?a:k)[s](v+d.type,l,!1),!c&&(c=!0)&&b.call(a,d.type||d)},t=function(){try{m.doScroll("left")}catch(a){setTimeout(t,50);return}l("poll")};if("complete"==k.readyState)b.call(a,"lazy");else{if(k.createEventObject&&m.doScroll){try{d=!a.frameElement}catch(p){}d&&t()}k[r](v+"DOMContentLoaded",l,!1);k[r](v+"readystatechange",l,!1);a[r](v+"load",l,!1)}};this.sourceURL?setTimeout(function(){d(c,a||function(){})},10):d(c,a||
function(){})},getDocument:function(){return this.popupWindow.document},cleanup:function(){this.beforeCleanupCallback&&this.beforeCleanupCallback();this.beforeCleanupCallback=null;this.popupWindow.close();this.popupWindow=null;this.cleanupHanlders();this.cleanupCallback&&this.cleanupCallback();this.cleanupCallback=null}}});
Class("Scope.Provider.NodeJS",{isa:Scope.Provider,has:{sourceURL:null},methods:{compile:function(a,b,c){var d=require("module"),e=require("path");b=b.replace(/^\#\!.*/,"");var f=function(b){return a.require(b)};f.resolve=function(b){return d._resolveFilename(b,a)[1]};Object.defineProperty(f,"paths",{get:function(){throw Error("modRequire.paths is removed. Use node_modules folders, or the NODE_PATH environment variable instead.");}});f.main=process.mainModule;f.extensions=d._extensions;f.registerExtension=
function(){throw Error("modRequire.registerExtension() removed. Use modRequire.extensions instead.");};f.cache=d._cache;e=e.dirname(c);b=d.wrap(b);return require("vm").runInContext(b,this.scope,c).apply(a.exports,[a.exports,f,a,c,e])},addOnErrorHandler:function(a,b){},create:function(a){var b=require("vm"),c={};Joose.O.extend(c,{process:process,global:c,root:root,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval});this.scope=b.createContext(c);a&&
a()},setup:function(a){this.create();var b=this;this.seedingCode&&require("vm").runInContext(this.seedingCode,this.scope);Joose.A.each(this.getPreload(),function(a){"js"==a.type&&(a.url?b.runScript(a.url):b.runCode(a.content))});if(this.seedingScript){var c=require("module"),d=require("path"),c=new c("./"+this.sourceURL,require.main),d=c.filename=d.join(d.dirname(require.main.filename),this.sourceURL),e=require("fs").readFileSync(d,"utf8");65279===e.charCodeAt(0)&&(e=e.slice(1));this.compile(c,e,
d)}a&&a()},runCode:function(a,b){var c=require("vm").runInContext(a,this.scope);b&&b(c);return c},runScript:function(a,b){var c=require("fs").readFileSync(a,"utf8"),c=require("vm").runInContext(c,this.scope,a);b&&b(c);return c},cleanup:function(){this.beforeCleanupCallback&&this.beforeCleanupCallback();this.cleanupCallback&&this.cleanupCallback()}}});
Class("JooseX.Observable.Event",{has:{name:{required:!0},args:{required:!0},source:{required:!0},splat:null,current:null,bubbling:!0},methods:{stopPropagation:function(){this.bubbling=!1}}});
Class("JooseX.Observable.Listener",{has:{channel:{required:!0},eventName:{required:!0},func:{required:!0},scope:null,single:!1,buffer:null,bufferMax:null,bufferStartedAt:null,bufferTimeout:null,delayTimeout:null,delay:null},methods:{activate:function(a,b){var c=this;if(null!=c.buffer){if(null!=c.bufferMax)if(!c.bufferStartedAt)c.bufferStartedAt=new Date;else if(new Date-c.bufferStartedAt>c.bufferMax)return;c.bufferTimeout&&clearTimeout(c.bufferTimeout);c.bufferTimeout=setTimeout(function(){delete c.bufferStartedAt;
delete c.bufferTimeout;c.doActivate(a,b)},c.buffer)}else if(null!=c.delay)c.delayTimeout=setTimeout(function(){delete c.delayTimeout;c.doActivate(a,b)},c.delay);else return c.doActivate(a,b)},doActivate:function(a,b){this.single&&this.remove();return!1!==this.func.apply(this.scope||a.source,[a].concat(b))},cancel:function(){this.buffer&&(clearTimeout(this.bufferTimeout),delete this.bufferTimeout,delete this.bufferStartedAt);this.delay&&clearTimeout(this.delayTimeout)},remove:function(){this.channel.removeListener(this)}}});
Class("JooseX.Observable.Channel",{has:{channels:Joose.I.Object,listeners:Joose.I.Object},methods:{destroy:function(){Joose.O.each(this.channels,function(a,b){a.purgeListeners()});this.channels=null;Joose.O.each(this.listeners,function(a,b){this.listeners[b]=null},this);this.listeners=null},getListenersFor:function(a,b,c){var d=this.listeners;if(d["**"]){var e=a.concat(b);Joose.A.each(d["**"],function(a){c.push({listener:a,splat:e})})}a.length?(d=this.getSingleChannel(a.shift(),!0))&&d.getListenersFor(a,
b,c):(d["*"]&&Joose.A.each(d["*"],function(a){c.push({listener:a,splat:b})}),d[b]&&Joose.A.each(d[b],function(a){c.push({listener:a})}))},hasListenerFor:function(a,b){var c=this.listeners;if(c["**"]&&c["**"].length)return!0;if(a.length){if(c=this.getSingleChannel(a.shift(),!0))return c.hasListenerFor(a,b)}else if(c["*"]&&c["*"].length||c[b]&&c[b].length)return!0;return!1},addListener:function(a){var b=a.eventName,c=this.listeners;c[b]=c[b]||[];c[b].push(a)},removeListener:function(a){if(this.listeners){var b=
this.listeners[a.eventName];b&&Joose.A.each(b,function(c,d){if(c==a)return b.splice(d,1),!1})}},removeListenerByHandler:function(a,b,c){var d=this.listeners[a];d&&Joose.A.each(d,function(a,f){if(a.func==b&&a.scope==c)return d.splice(f,1),!1})},getSingleChannel:function(a,b){var c=this.channels;return c[a]?c[a]:b?null:c[a]=new JooseX.Observable.Channel},getChannel:function(a,b){if(!a.length)return this;var c=this.getSingleChannel(a.shift(),b);return b&&!c?null:c.getChannel(a,b)}}});
Role("JooseX.Observable",{VERSION:0.04,has:{rootChannel:{is:"rw",init:function(){return new JooseX.Observable.Channel}},suspendCounter:0},methods:{getBubbleTarget:function(){},parseEventPath:function(a){a=a.split("/");var b=a.pop();a.length&&!a[0]&&a.shift();return{channels:a,eventName:b}},on:function(a,b,c,d){if(!b)throw"Not valid listener function provided when subsribing on event: "+a;var e=this.parseEventPath(a);a=this.getRootChannel().getChannel(e.channels);b=new JooseX.Observable.Listener(Joose.O.extend(d||
{},{channel:a,eventName:e.eventName,func:b,scope:c}));a.addListener(b);return b},un:function(a,b,c){if(a instanceof JooseX.Observable.Listener)a.remove();else{a=this.parseEventPath(a);var d=this.getRootChannel().getChannel(a.channels,!0);d&&d.removeListenerByHandler(a.eventName,b,c)}},emit:function(){return this.fireEvent.apply(this,arguments)},fireEvent:function(a){if(!this.suspendCounter){var b=Array.prototype.slice.call(arguments,1),c=new JooseX.Observable.Event({name:a,args:b,source:this});return this.propagateEvent(c,
a,b)}},propagateEvent:function(a,b,c){if(!this.suspendCounter){var d=this.parseEventPath(b),e=d.eventName;if("*"==!e||"**"==e)throw Error("Can't fire an empty event or event with `*`, `**` names ");var f=[];this.getRootChannel().getListenersFor(d.channels,e,f);var g=!0;a.current=this;f.length&&Joose.A.each(f,function(b){a.splat=b.splat;g=!1!==b.listener.activate(a,c)&&g});a.bubbling&&(d=this.getBubbleTarget())&&(g=!1!==d.propagateEvent(a,b,c)&&g);return g}},hasListenerFor:function(a){a=this.parseEventPath(a);
return this.getRootChannel().hasListenerFor(a.channels,a.eventName)},purgeListeners:function(){this.rootChannel.destroy();this.rootChannel=new JooseX.Observable.Channel},suspendEvents:function(){this.suspendCounter++},resumeEvents:function(){this.suspendCounter--;0>this.suspendCounter&&(this.suspendCounter=0)}}});var JSON;JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var e,h,l,t,p=f,q,n=d[a];n&&("object"===typeof n&&"function"===typeof n.toJSON)&&(n=n.toJSON(a));"function"===typeof k&&(n=k.call(d,a,n));switch(typeof n){case "string":return b(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";f+=g;q=[];if("[object Array]"===Object.prototype.toString.apply(n)){t=n.length;for(e=0;e<t;e+=1)q[e]=c(e,n)||"null";l=0===q.length?"[]":f?"[\n"+f+q.join(",\n"+f)+"\n"+p+"]":"["+q.join(",")+"]";f=p;return l}if(k&&"object"===typeof k)for(t=k.length,e=0;e<t;e+=1)"string"===typeof k[e]&&(h=k[e],(l=c(h,n))&&q.push(b(h)+(f?": ":":")+l));else for(h in n)Object.prototype.hasOwnProperty.call(n,h)&&(l=c(h,n))&&q.push(b(h)+(f?": ":":")+l);l=0===q.length?"{}":f?"{\n"+f+q.join(",\n"+
f)+"\n"+p+"}":"{"+q.join(",")+"}";f=p;return l}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(b){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var e;g=f="";if("number"===typeof d)for(e=0;e<d;e+=1)g+=" ";else"string"===typeof d&&(g=d);if((k=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,f,g=a[d];if(g&&"object"===typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=c(g,e),void 0!==f?g[e]=f:delete g[e]);return b.call(a,d,g)}var e;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof b?c({"":e},""):e;throw new SyntaxError("JSON.parse");})})();
!function(){var a=1;Class("Data.Visitor2",{has:{seenPlaceholder:{init:{}},outOfDepthPlaceholder:{init:{}},seen:Joose.I.Object,maxDepth:null},methods:{getClassNameFor:function(a){return Joose.O.isInstance(a)?a.meta.name:Object.prototype.toString.call(a).replace(/^\[object /,"").replace(/\]$/,"")},getRefAdr:function(){return a++},assignRefAdrTo:function(b){b.__REFADR__||(Object.defineProperty?Object.defineProperty(b,"__REFADR__",{value:a++}):b.__REFADR__=a++);return b.__REFADR__},isSeen:function(a){return a.__REFADR__&&
this.seen.hasOwnProperty(a.__REFADR__)},markSeenAs:function(a,c){return this.seen[a.__REFADR__]=c},hasSeenResultFor:function(a){a=a.__REFADR__;return this.seen.hasOwnProperty(a)&&this.seen[a]!=this.seenPlaceholder},visit:function(a,c){return c>this.maxDepth?this.visitOutOfDepthValue(a,c+1):Object(a)===a?this.isSeen(a)?this.visitSeen(a,c+1):this.visitNotSeen(a,c+1):this.visitValue(a,c+1)},visitOutOfDepthValue:function(a,c){return this.outOfDepthPlaceholder},visitValue:function(a,c){return a},visitSeen:function(a,
c){return this.seen[a.__REFADR__]},getInitialSeenMarker:function(a,c){return this.seenPlaceholder},visitNotSeen:function(a,c){this.assignRefAdrTo(a);this.markSeenAs(a,this.getInitialSeenMarker(a,c));if(Joose.O.isInstance(a))return this.markSeenAs(a,this.visitJooseInstance(a,c));var d="visit"+this.getClassNameFor(a);this.meta.hasMethod(d)||(d="visitObject");return this.markSeenAs(a,this[d](a,c))},visitArray:function(a,c){Joose.A.each(a,function(d,e){this.visitArrayEntry(d,e,a,c)},this);return a},visitArrayEntry:function(a,
c,d,e){return this.visit(a,e)},visitObject:function(a,c){Joose.O.eachOwn(a,function(d,e){"__REFADR__"!=e&&(this.visitObjectKey(e,d,a,c),this.visitObjectValue(d,e,a,c))},this);return a},visitJooseInstance:function(a,c){return this.visitObject(a,c)},visitObjectKey:function(a,c,d,e){return this.visitValue(a,e)},visitObjectValue:function(a,c,d,e){return this.visit(a,e)}},my:{has:{HOST:null},methods:{visit:function(a,c){return(new this.HOST({maxDepth:c||Infinity})).visit(a,0)}}}})}();
Class("Siesta.Util.Serializer",{isa:Data.Visitor2,has:{result:Joose.I.Array,manualEnum:function(){for(var a in{toString:1})return!1;return!0}},methods:{assignRefAdrTo:function(a){try{return this.SUPER(a)}catch(b){a.__REFADR__||(a.__REFADR__=this.getRefAdr())}return a.__REFADR__},write:function(a){this.result.push(a)},visitOutOfDepthValue:function(a,b){this.write("...")},visitValue:function(a){null==a?this.write(a+""):this.write("string"==typeof a?'"'+a.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':
a+"")},visitObjectKey:function(a,b,c){this.write('"'+a+'": ')},getClassNameFor:function(a){return null!=a.nodeType&&null!=a.nodeName&&a.tagName?"DOMElement":null!=a.document&&null!=a.location&&null!=a.location.href?"Window":this.SUPER(a)},visitSeen:function(a,b){this.write("[Circular]")},visitRegExp:function(a,b){this.write(a+"")},visitFunction:function(a,b){this.write("function "+(a.name||"")+"() { ... }")},visitDate:function(a,b){this.write('"'+a+'"')},visitObject:function(a,b){for(var c in a)if("__REFADR__"!=
c&&(!a.hasOwnProperty||a.hasOwnProperty(c))){var d=a[c];this.visitObjectKey(c,d,a,b);this.visitObjectValue(d,c,a,b)}var e=this;this.manualEnum&&Joose.A.each(["hasOwnProperty","valueOf","toString","constructor"],function(c){if(a.hasOwnProperty&&a.hasOwnProperty(c)){var d=a[c];e.visitObjectKey(c,d,a,b);e.visitObjectValue(d,c,a,b)}});return a},visitJooseInstance:function(a,b){return a.meta.hasMethod("toString")?(this.write(a.toString()),a):this.SUPERARG(arguments)},visitDOMElement:function(a,b){var c=
"&lt;"+a.tagName;a.id&&(c+=' id="'+a.id+'"');a.className&&(c+=' class="'+a.className+'"');this.write(c+"&gt;")},visitDOMStringMap:function(){this.write("[DOMStringMap]")},visitWindow:function(){this.write("[window]")},visitLocation:function(){this.write("[window.location]")}},before:{visitObject:function(){this.write("{")},visitArray:function(){this.write("[")}},after:{visitObject:function(){var a=this.result;", "==a[a.length-1]&&a.pop();this.write("}")},visitArray:function(){var a=this.result;", "==
a[a.length-1]&&a.pop();this.write("]")},visitObjectValue:function(){this.write(", ")},visitArrayEntry:function(){this.write(", ")}},my:{has:{HOST:null},methods:{stringify:function(a,b){var c=new this.HOST({maxDepth:b||4});c.visit(a,0);return c.result.join("")}}}});
Role("Siesta.Util.Role.CanFormatStrings",{has:{serializeFormatingPlaceholders:!0},methods:{formatString:function(a,b){if(!b)return a;for(var c,d=[],e=[],f=/\{(\!)?((?:\w|-|_)+?)\}/g;c=f.exec(a);)e.push(c[1]),d.push(c[2]);var g=a;Joose.A.each(d,function(a,c){var d=e[c];g=g.replace(RegExp("\\{"+(d?"!":"")+a+"\\}","g"),b.hasOwnProperty(a)?d||!this.serializeFormatingPlaceholders?b[a]+"":Siesta.Util.Serializer.stringify(b[a]):"")},this);return g}}});
Role("Siesta.Util.Role.CanGetType",{methods:{typeOf:function(a){return Object.prototype.toString.call(a).slice(8,-1)}}});
Class("Siesta.Util.Queue",{has:{steps:Joose.I.Array,interval:100,callbackDelay:0,deferer:{required:!0},deferClearer:null,processor:null,processorScope:null,currentTimeout:null,callback:null,scope:null,isAborted:!1,observeTest:null,currentDelayStepId:null,isDestroyed:!1},methods:{addStep:function(a){this.addSyncStep(a)},addSyncStep:function(a){this.steps.push(a)},addAsyncStep:function(a){a.isAsync=!0;this.steps.push(a)},addDelayStep:function(a){var b=this.deferer,c=this;this.addAsyncStep({processor:function(d){c.currentDelayStepId=
b(d.next,a||500)}})},run:function(a,b){this.callback=a;this.scope=b;this.observeTest&&this.observeTest.on("testfinalize",function(){this.abort(!0)},this,{single:!0});this.doSteps(this.steps.slice(),a,b)},abort:function(a){if(!this.isDestroyed){this.isAborted=!0;var b=this.deferClearer;if(!b)throw"Need `deferClearer` to be able to `abort` the queue";b(this.currentDelayStepId);b(this.currentTimeout);a||this.callback.call(this.scope||this);this.destroy()}},doSteps:function(a,b,c){this.currentTimeout=
null;var d=this,e=this.deferer,f=a.shift();if(!this.isAborted)if(f)for(;this.doOneStep(f,a,b,c)&&!this.isAborted;)if(a.length)f=a.shift();else{this.doSteps(a,b,c);break}else b&&(this.callbackDelay?e(function(){d.isAborted||(b.call(c||this),d.destroy())},this.callbackDelay):(b.call(c||this),d.destroy()))},doOneStep:function(a,b,c,d){var e=this,f=this.deferer,g=a.processor||this.processor,h=a.processorScope||this.processorScope,k=this.steps.length-b.length-1;if(!g)throw Error("No process function found for step: "+
k);if(a.isAsync){var m=!1,r=!1,f=a.next=function(){r?e.doSteps(b,c,d):m=!0};g.call(h||e,a,k,this,f);r=!0;if(m)return!0}else g.call(h||e,a,k,this),this.isAborted||((a=a.interval||e.interval)?this.currentTimeout=f(function(){e.doSteps(b,c,d)},a):e.doSteps(b,c,d))},destroy:function(){if(!this.isDestroyed){this.processor=this.processorScope=this.callback=this.observeTest=this.deferer=this.deferClearer=null;for(var a=0;a<this.steps.length;a++)this.steps[a].next=null;this.steps=null;this.isDestroyed=!0}}}});
Class("Siesta.Util.XMLNode",{has:{children:Joose.I.Array,tag:{required:!0},attributes:Joose.I.Object,textContent:null,escapeTable:{init:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}}},methods:{escapeXml:function(a){var b=this;return"string"!=typeof a?a:a.replace(/[&<>"]/g,function(a){return b.escapeTable[a]})},toString:function(){var a=this,b=[];Joose.A.each(this.children,function(a){b.push(a.toString())});var c=[];Joose.O.each(this.attributes,function(b,e){c.push(e+'="'+a.escapeXml(b)+'"')});
c.sort();c.unshift(this.tag);return"<"+c.join(" ")+">"+(null!=this.textContent?this.escapeXml(this.textContent):"")+b.join("")+"</"+this.tag+">"},appendChild:function(a){a instanceof Siesta.Util.XMLNode?a.parent=this:a=new Siesta.Util.XMLNode(Joose.O.extend(a,{parent:this}));this.children.push(a);return a},setAttribute:function(a,b){this.attributes[a]=b}}});
Class("Siesta.Util.Rect",{has:{left:null,top:null,width:null,height:null,right:null,bottom:null},methods:{initialize:function(){var a=this.left,b=this.width,c=this.right;null==c&&(null!=a&&null!=b)&&(this.right=a+b-1);null==b&&(null!=a&&null!=c)&&(this.width=c-a+1);a=this.top;b=this.height;c=this.bottom;null==c&&(null!=a&&null!=b)&&(this.bottom=a+b-1);null==b&&(null!=a&&null!=c)&&(this.height=c-a+1)},isEmpty:function(){return null==this.left},intersect:function(a){return a.isEmpty()||this.isEmpty()||
a.left>this.right||a.right<this.left||a.top>this.bottom||a.bottom<this.top?this.my.getEmpty():new this.constructor({left:Math.max(this.left,a.left),right:Math.min(this.right,a.right),top:Math.max(this.top,a.top),bottom:Math.min(this.bottom,a.bottom)})},contains:function(a,b){return this.left<=a&&a<=this.right&&this.top<=b&&b<=this.bottom},cropLeftRight:function(a){return this.intersect(new this.constructor({left:a.left,right:a.right,top:this.top,bottom:this.bottom}))},cropTopBottom:function(a){return this.intersect(new this.constructor({left:this.left,
right:this.right,top:a.top,bottom:a.bottom}))},equalsTo:function(a){return this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom}},my:{has:{HOST:null},methods:{getEmpty:function(){return new this.HOST}}}});Class("Siesta.Content.Resource",{has:{url:null,content:null},methods:{asHTML:function(){throw"Abstract method called";},asDescriptor:function(){throw"Abstract method called";},canCache:function(){}}});
Class("Siesta.Content.Resource.CSS",{isa:Siesta.Content.Resource,has:{},methods:{asHTML:function(){},asDescriptor:function(){var a={type:"css"};this.url&&(a.url=this.url);this.content&&(a.content=this.content);return a}}});Class("Siesta.Content.Resource.JavaScript",{isa:Siesta.Content.Resource,has:{instrument:!1},methods:{asHTML:function(){},asDescriptor:function(){var a={type:"js"};this.url&&(a.url=this.url);this.content&&(a.content=this.content);return a}}});
Class("Siesta.Content.Preset",{has:{preload:Joose.I.Array,resources:Joose.I.Array},methods:{initialize:function(){var a=this;Joose.A.each(this.preload,function(b){a.addResource(b)})},isCSS:function(a){return/\.css(\?.*)?$/i.test(a)},getResourceFromDescriptor:function(a){var b,c;if("string"==typeof a)b=this.isCSS(a)?Siesta.Content.Resource.CSS:Siesta.Content.Resource.JavaScript,c={url:a};else if(a.text)b=Siesta.Content.Resource.JavaScript,c={content:a.text};else{if(!a.url&&!a.content)throw"Incorrect preload descriptor:"+
a;b=a.type&&"css"==a.type||this.isCSS(a.url)?Siesta.Content.Resource.CSS:Siesta.Content.Resource.JavaScript;c={};a.url&&(c.url=a.url);a.content&&(c.content=a.content);a.instrument&&(c.instrument=a.instrument)}return new b(c)},addResource:function(a){a=a instanceof Siesta.Content.Resource&&a||this.getResourceFromDescriptor(a);this.resources.push(a);return a},eachResource:function(a,b){return Joose.A.each(this.resources,a,b||this)},prepareScope:function(a,b){this.eachResource(function(c){b.hasContentOf(c)?
a.addPreload({type:c instanceof Siesta.Content.Resource.CSS?"css":"js",content:b.getContentOf(c)}):a.addPreload(c.asDescriptor())})}}});
Class("Siesta.Content.Manager",{has:{disabled:!1,presets:{required:!0},urls:Joose.I.Object,maxLoads:5,harness:null},methods:{cache:function(a,b,c){if(this.disabled)a&&a();else{var d=this.urls,e=this;Joose.A.each(this.presets,function(a){a.eachResource(function(a){a.url&&(d[a.url]=null)})});var f=0,g=0,h=[];Joose.O.each(d,function(a,b){e.hasContentOf(b)||h.push(b)});var k=h.length;if(k)for(var m=function(){if(h.length){var r=h.shift();e.load(r,function(b){g||(d[r]=b,++f==k?a&&a():m())},c?function(){++f==
k?a&&a():m()}:function(){g++;b&&b(r)})}},r=0;r<this.maxLoads;r++)m();else a&&a()}},load:function(a,b,c){throw"abstract method `load` called";},addContent:function(a,b){this.urls[a]=b},hasContentOf:function(a){a instanceof Siesta.Content.Resource&&(a=a.url);return"string"==typeof this.urls[a]},getContentOf:function(a){a instanceof Siesta.Content.Resource&&(a=a.url);return this.urls[a]}}});
Class("Siesta",{VERSION:"3.0.1",my:{has:{config:null,activeHarness:null},methods:{getConfigForTestScript:function(a){try{return eval(a),this.config}catch(b){return null}},StartTest:function(a,b){this.config="object"==typeof a?a:"object"==typeof b?b:null}}}});"undefined"==typeof StartTest&&(StartTest=Siesta.StartTest);"undefined"==typeof startTest&&(startTest=Siesta.StartTest);"undefined"==typeof describe&&(describe=Siesta.StartTest);
Siesta.CurrentLocale=Siesta.CurrentLocale||{"Siesta.Harness.Browser.UI.AboutWindow":{upgradeText:"Upgrade to Siesta Standard",closeText:"Close",titleText:"ABOUT SIESTA (v. {VERSION})",bodyText:'<img height="35" src="http://www.bryntum.com/bryntum-logo.png"/>             <p>Siesta is a JavaScript unit and functional test tool made by <a target="_blank" href="http://www.bryntum.com">Bryntum</a>. You can test any web page or JavaScript code, including Ext JS, jQuery or NodeJS.              Siesta comes in two versions: <strong>Lite</strong> and <strong>Standard</strong>. With Lite, you can launch your tests in the browser UI.              With the Standard version, you can also automate your tests and use the automation scripts together with tools like PhantomJS or Selenium WebDriver. </p>             Siesta would not be possible without these awesome products & libraries: <br>                     <ul style="padding:0 0 0 30px">                       <li><a href="http://sencha.com/extjs">Ext JS</a></li>                        <li><a href="http://jquery.com">jQuery</a></li>                        <li><a href="http://http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a></li>                        <li><a href="http://joose.it/">Joose</a></li>                        <li><a href="https://github.com/gotwarlost/istanbul">Istanbul</a></li>                     </ul>'},
"Siesta.Harness.Browser.UI.AssertionGrid":{initializingText:"Initializing test..."},"Siesta.Harness.Browser.UI.CoverageReport":{closeText:"Close",showText:"Show: ",lowText:"Low",mediumText:"Med",highText:"High",statementsText:"Statements",branchesText:"Branches",functionsText:"Functions",linesText:"Lines",loadingText:"Loading coverage data...",loadingErrorText:"Loading error",loadingErrorMessageText:"Could not load the report data from this url: ",globalNamespaceText:"[Global namespace]"},"Siesta.Harness.Browser.UI.DomContainer":{title:"DOM Panel",
viewDocsText:"View documentation for ",docsUrlText:"http://docs.sencha.com/{0}/apidocs/#!/api/{1}"},"Siesta.Harness.Browser.UI.ResultPanel":{rerunText:"Run test",toggleDomVisibleText:"Toggle DOM visible",viewSourceText:"View source",showFailedOnlyText:"Show failed only",componentInspectorText:"Toggle Ext Component Inspector",eventRecorderText:"Event Recorder",closeText:"Close"},"Siesta.Harness.Browser.UI.TestGrid":{title:"Test list",nameText:"Name",filterTestsText:"Filter tests",expandCollapseAllText:"Expand / Collapse all",
runCheckedText:"Run checked",runFailedText:"Run failed",runAllText:"Run all",showCoverageReportText:"Show coverage report",passText:"Pass",failText:"Fail",optionsText:"Options...",todoPassedText:"todo assertion(s) passed",todoFailedText:"todo assertion(s) failed",viewDomText:"View DOM",transparentExText:"Transparent exceptions",cachePreloadsText:"Cache preloads",autoLaunchText:"Auto launch",speedRunText:"Speed run",breakOnFailText:"Break on fail",debuggerOnFailText:"Debugger on fail",aboutText:"About Siesta",
documentationText:"Siesta Documentation",siestaDocsUrl:"http://bryntum.com/docs/siesta",filterFieldTooltip:'Supported formats for tests filtering:\n1) TERM1 TERM2 - both "TERM1" and "TERM2" should present in the test url\n2) TERM1 TERM2 | TERM3 TERM4 | ... - both "TERM1" and "TERM2" should present in the test url, OR both TERM3 and TERM4, etc, can be repeated indefinitely\n3) GROUP_TERM > TEST_TERM - filters only withing the specified `group`',landscape:"Landscape"},"Siesta.Harness.Browser.UI.VersionUpdateButton":{newUpdateText:"New Update Available...",
updateWindowTitleText:"New version available for download! Current version: ",cancelText:"Cancel",changelogLoadFailedText:"Bummer! Failed to fetch changelog.",downloadText:"Download ",liteText:" (Lite)",standardText:" (Standard)",loadingChangelogText:"Loading changelog..."},"Siesta.Harness.Browser.UI.Viewport":{apiLinkText:"API Documentation",apiLinkUrl:"http://bryntum.com/docs/siesta",uncheckOthersText:"Uncheck others (and check this)",uncheckAllText:"Uncheck all",checkAllText:"Check all",runThisText:"Run this",
expandAll:"Expand all",collapseAll:"Collapse all",filterToCurrentGroup:"Filter to current group",filterToFailed:"Filter to failed",httpWarningTitle:"You must use a web server",httpWarningDesc:"You must run Siesta in a web server context, and not using the file:/// protocol"},"Siesta.Harness.Browser":{codeCoverageWarningText:"Can not enable code coverage - did you forget to include the `siesta-coverage-all.js` on the harness page?",noJasmine:"No `jasmine` object found on spec runner page",noJasmineSiestaReporter:"Can't find SiestaReporter in Jasmine. \nDid you add the `siesta/bin/jasmine-siesta-reporter.js` file to your spec runner page?"},
"Siesta.Result.Assertion":{todoText:"TODO: ",passText:"ok",failText:"fail"},"Siesta.Role.ConsoleReporter":{passText:"PASS",failText:"FAIL",warnText:"WARN",missingFileText:"Test file [{URL}] not found.",allTestsPassedText:"All tests passed",failuresFoundText:"There are failures"},"Siesta.Test.Action.Drag":{byOrToMissingText:'Either "to" or "by" configuration option is required for "drag" step',byAndToDefinedText:'Exactly one of "to" or "by" configuration options is required for "drag" step, not both'},
"Siesta.Test.Action.Eval":{invalidMethodNameText:"Invalid method name: ",wrongFormatText:"Wrong format of the action string: ",parseErrorText:"Can't parse arguments: "},"Siesta.Test.Action.Wait":{missingMethodText:"Could not find a waitFor method named "},"Siesta.Test.BDD.Expectation":{expectText:"Expect",needNotText:"Need not",needText:"Need",needMatchingText:"Need matching",needNotMatchingText:"Need not matching",needStringNotContainingText:"Need string not containing",needStringContainingText:"Need string containing",
needArrayNotContainingText:"Need array not containing",needArrayContainingText:"Need array containing",needGreaterEqualThanText:"Need value greater or equal than",needGreaterThanText:"Need value greater than",needLessThanText:"Need value less than",needLessEqualThanText:"Need value less or equal than",needValueNotCloseToText:"Need value not close to",needValueCloseToText:"Need value close to",toBeText:"to be",toBeDefinedText:"to be defined",toBeUndefinedText:"to be undefined",toBeEqualToText:"to be equal to",
toBeTruthyText:"to be truthy",toBeFalsyText:"to be falsy",toMatchText:"to match",toContainText:"to contain",toBeLessThanText:"to be less than",toBeGreaterThanText:"to be greater than",toBeCloseToText:"to be close to",toThrowText:"to throw exception",thresholdIsText:"Threshold is ",exactMatchText:"Exact match text",thrownExceptionText:"Thrown exception",noExceptionThrownText:"No exception thrown",wrongSpy:"Incorrect spy instance",toHaveBeenCalledDescTpl:"Expect method {methodName} to have been called {need} times",
actualNbrOfCalls:"Actual number of calls",expectedNbrOfCalls:"Expected number of calls",toHaveBeenCalledWithDescTpl:"Expect method {methodName} to have been called at least once with the specified arguments"},"Siesta.Test.ExtJS.Ajax":{ajaxIsLoading:"An Ajax call is currently loading",allAjaxRequestsToComplete:"all ajax requests to complete",ajaxRequest:"ajax request",toComplete:"to complete"},"Siesta.Test.ExtJS.Component":{badInputText:"Expected an Ext.Component, got",toBeVisible:"to be visible",
toNotBeVisible:"to not be visible",component:"component",Component:"Component",componentQuery:"componentQuery",compositeQuery:"composite query",toReturnEmptyArray:"to return an empty array",toReturnEmpty:"to return empty",toReturnAVisibleComponent:"to return a visible component",toReturnHiddenCmp:"to return a hidden/missing component",invalidDestroysOkInput:"No components provided, or component query returned empty result",exception:"Exception",exceptionAnnotation:'Exception thrown while calling "destroy" method of',
destroyFailed:"was not destroyed (probably destroy was canceled in the `beforedestroy` listener)",destroyPassed:"All passed components were destroyed ok"},"Siesta.Test.ExtJS.DataView":{view:"view",toRender:"to render"},"Siesta.Test.ExtJS.Element":{top:"top",left:"left",bottom:"bottom",right:"right"},"Siesta.Test.ExtJS.Grid":{waitForRowsVisible:"rows to show for panel with id"},"Siesta.Test.ExtJS.Observable":{hasListenerInvalid:"1st argument for `t.hasListener` should be an observable instance",hasListenerPass:"Observable has listener for {eventName}",
hasListenerFail:"Provided observable has no listeners for event",isFiredWithSignatureNotFired:'event was not fired during the test"',observableFired:"Observable fired",correctSignature:"with correct signature",incorrectSignature:"with incorrect signature"},"Siesta.Test.ExtJS.Store":{storesToLoad:"stores to load",failedToLoadStore:"Failed to load the store",URL:"URL"},"Siesta.Test.Action":{missingTestAction:"Action [{0}] requires `{1}` method in your test class"},"Siesta.Test.BDD":{codeBodyMissing:"Code body is not provided for",
codeBodyOf:"Code body of",missingFirstArg:"does not declare a test instance as 1st argument",iitFound:"t.iit should only be used during debugging",noObject:"No object to spy on"},"Siesta.Test.BDD.Spy":{spyingNotOnFunction:"Trying to create a spy over a non-function property"},"Siesta.Test.Browser":{noDomElementFound:"No DOM element found for CSS selector",noActionTargetFound:"No action target found for",waitForEvent:"observable to fire its",event:"event",wrongFormat:"Wrong format for expected number of events",
unrecognizedSignature:"Unrecognized signature for `firesOk`",observableFired:"Observable fired",observableFiredOk:"Observable fired expected number of",actualNbrEvents:"Actual number of events",expectedNbrEvents:"Expected number of events",events:"events",noElementFound:"Could not find any element at",targetElementOfAction:"Target element of action",targetElementOfSomeAction:"Target element of some action",isNotVisible:"is not visible or not reachable",text:"text",toBePresent:"to be present",toNotBePresent:"to not be present",
target:"target",toAppear:"to appear"},"Siesta.Test.Date":{isEqualTo:"is equal to",Got:"Got"},"Siesta.Test.Element":{elementContent:"element content",toAppear:"to appear",toDisappear:"to disappear",monkeyException:"Monkey testing action did not complete properly - probably an exception was thrown",monkeyNoExceptions:"No exceptions thrown during monkey test",monkeyActionLog:"Monkey action log",elementHasClass:"Element has the CSS class",elementHasNoClass:"Element has no CSS class",elementClasses:"Classes of element",
needClass:"Need CSS class",hasStyleDescTpl:"Element has correct {value} for CSS style {property}",elementStyles:"Styles of element",needStyle:"Need style",hasNotStyleDescTpl:"Element does not have: {value} for CSS style {property}",hasTheStyle:"Element has the style",element:"element",toBeTopEl:"to be the top element at its position",toNotBeTopEl:"to not be the top element at its position",selector:"selector",selectors:"selectors",toAppear:"to appear",toAppearAt:"to appear at",noCssSelector:"A CSS selector must be supplied",
waitForSelectorsBadInput:"An array of CSS selectors must be supplied",Position:"Position",noElementAtPosition:"No element found at the specified position",elementIsAtDescTpl:"DOM element or its child is at [ {x}, {y} ] coordinates",topElement:"Top element",elementIsAtPassTpl:"DOM element is at [ {x}, {y} ] coordinates",allowChildrenDesc:"Need exactly this or its child",allowChildrenAnnotation:"Passed element is not the top-most one and not the child of one",shouldBe:"Should be",noChildrenFailAnnotation:"Passed element is not the top-most one",
topLeft:"(t-l)",bottomLeft:"(b-l)",topRight:"(t-r)",bottomRight:"(b-r)",elementIsNotTopElementPassTpl:"Element is not the top element on the screen",selectorIsAtPassTpl:"Found element matching CSS selector {selector} at [ {xy} ]",elementMatching:"Element matching",selectorIsAtFailAnnotation:"Passed selector does not match any selector at",selectorExistsFailTpl:"No element matching the passed selector found",selectorExistsPassTpl:"Found DOM element(s) matching CSS selector {selector}",selectorNotExistsFailTpl:"Elements found matching the passed selector",
selectorNotExistsPassTpl:"Did not find any DOM element(s) matching CSS selector {selector}",toChangeForElement:"to change for element",selectorCountIsPassTpl:"Found exactly {count} elements matching {selector}",selectorCountIsFailTpl:"Found {got} elements matching the selector {selector}, expected {need}",isInViewPassTpl:"Passed element is within the visible viewport",toAppearInTheViewport:"to appear in the viewport",elementIsEmptyPassTpl:"Passed element is empty",elementIsNotEmptyPassTpl:"Passed element is not empty",
elementToBeEmpty:"element to be empty",elementToNotBeEmpty:"element to not be empty"},"Siesta.Test.ExtJS":{bundleUrlNotFound:"Cannot find Ext JS bundle url",assertNoGlobalExtOverridesInvalid:"Was not able to find the Ext JS bundle URL in the `assertNoGlobalExtOverrides` assertion",assertNoGlobalExtOverridesPassTpl:"No global Ext overrides found",assertNoGlobalExtOverridesGotDesc:"Number of overrides found",foundOverridesFor:"Found overrides for",animationsToFinalize:"animations to finalize",extOverridesInvalid:"Was not able to find the ExtJS bundle URL in the `assertMaxNumberOfGlobalExtOverrides` assertion)",
foundLessOrEqualThan:"Found less or equal than",nbrOverridesFound:"Number of overrides found",globalOverrides:"Ext JS global overrides"},"Siesta.Test.ExtJSCore":{waitedForRequires:"Waiting for required classes took too long - \nCheck the `Net` tab in Firebug and the `loaderPath` config",waitedForExt:"Waiting for Ext.onReady took too long - probably some dependency could not be loaded. \nCheck the `Net` tab in Firebug and the `loaderPath` config",waitedForApp:"Waiting for MVC application launch took too long - no MVC application on test page? \nYou may need to disable the `waitForAppReady` config option",
noComponentMatch:'Your component query: "{component}" returned no components',multipleComponentMatch:'Your component query: "{component}" returned more than 1 component',noComponentFound:"No component found for CQ",knownBugIn:"Known bug in",Class:"Class",wasLoaded:"was loaded",wasNotLoaded:"was not loaded",invalidCompositeQuery:"Invalid composite query selector",ComponentQuery:"ComponentQuery",CompositeQuery:"CompositeQuery",matchedNoCmp:"matched no Ext.Component",messageBoxVisible:"Message box is visible",
messageBoxHidden:"Message box is hidden"},"Siesta.Test.Function":{Need:"need",atLeast:"at least",exactly:"exactly",methodCalledExactly:"method was called exactly {n} times",exceptionEvalutingClass:"Exception [{e}] caught while evaluating the class name"},"Siesta.Test.More":{isGreaterPassTpl:"`{value1}` is greater than `{value2}`",isLessPassTpl:"`{value1}` is less than `{value2}`",isGreaterEqualPassTpl:"`{value1}` is greater or equal to`{value2}`",isLessEqualPassTpl:"`{value1}` is less or equal to`{value2}`",
isApproxToPassTpl:"`{value1}` is approximately equal to `{value2}`",needGreaterThan:"Need greater than",needGreaterEqualTo:"Need greater or equal to",needLessThan:"Need less than",needLessEqualTo:"Need less or equal to",exactMatch:"Exact match",withinThreshold:"Match within treshhold",needApprox:"Need approx",thresholdIs:"Threshold is",stringMatchesRe:"`{string}` matches regexp {regex}",stringNotMatchesRe:"`{string}` does not match regexp {regex}",needStringMatching:"Need string matching",needStringNotMatching:"Need string not matching",
needStringContaining:"Need string containing",needStringNotContaining:"Need string not containing",stringHasSubstring:"`{string}` has a substring: `{regex}`",stringHasNoSubstring:"`{string}` does not have a substring: `{regex}`",throwsOkInvalid:"throws_ok accepts a function as 1st argument",didntThrow:"Function did not throw an exception",exMatchesRe:"Function throws exception matching to {expected}",exceptionStringifiesTo:"Exception stringifies to",exContainsSubstring:"Function throws exception containing a substring: {expected}",
fnDoesntThrow:"Function does not throw any exceptions",fnThrew:"Function threw an exception",isInstanceOfPass:"Object is an instance of the specified class",needInstanceOf:"Need instance of",isAString:"{value} is a string",aStringValue:"AStringValue",isAnObject:"{value} is an object",anObject:"An object value",isAnArray:"{value} is an array",anArrayValue:"An array value",isANumber:"{value} is a number",aNumberValue:"a number value",isABoolean:"{value} is a boolean",aBooleanValue:"a number value",
isADate:"{value} is a date",aDateValue:"a date value",isARe:"{value} is a regular expression",aReValue:"a regular expression",isAFunction:"{value} is a function",aFunctionValue:"a function",isDeeplyPassTpl:"{obj1} is deeply equal to {obj2}",isDeeplyStrictPassTpl:"{obj1} is strictly deeply equal to {obj2}",globalCheckNotSupported:"Testing leakage of global variables is not supported on this platform",globalVariables:"Global Variables",noGlobalsFound:"No unexpected global variables found",globalFound:"Unexpected global found",
globalName:"Global name",value:"value",conditionToBeFulfilled:"condition to be fulfilled",ms:"ms",waitingFor:"Waiting for",waitedTooLong:"Waited too long for",conditionNotFulfilled:"Condition was not fullfilled during",waitingAborted:"Waiting aborted",Waited:"Waited",checkerException:"checker threw an exception",Exception:"Exception",msFor:"ms for",forcedWaitFinalization:"Forced finalization of waiting for",chainStepNotCompleted:"The step in `t.chain()` call did not complete within required timeframe, chain can not proceed",
stepNumber:"Step number",oneBased:"(1-based)",atLine:"At line",chainStepEx:"Chain step threw an exception",stepFn:"Step function",notUsingNext:'does not use the provided "next" function anywhere',calledMoreThanOnce:"The `next` callback of {num} step (1-based) of `t.chain()` call at line {line} is called more than once."},"Siesta.Test.SenchaTouch":{STSetupFailed:"Waiting for Ext.setup took too long - some dependency could not be loaded? Check the `Net` tab in Firebug",invalidSwipeDir:"Invalid swipe direction",
moveFingerByInvalidInput:"Trying to call moveFingerBy without relative distances",scrollUntilFailed:"scrollUntil failed to achieve its mission",scrollUntilElementVisibleInvalid:"scrollUntilElementVisible: target or scrollable not provided",scrollerReachPos:"scroller to reach position"},"Siesta.Test":{noCodeProvidedToTest:"No code provided to test",addingAssertionsAfterDone:"Adding assertions after the test has finished",testFailedAndAborted:"Assertion failed, test execution aborted",atLine:"at line",
of:"of",character:"character",isTruthy:'`{value}` is a "truthy" value',needTruthy:'Need "truthy" value',isFalsy:'`{value}` is a "falsy" value',needFalsy:'Need "falsy" value',isEqualTo:"`{got}` is equal to `{expected}`",isNotEqualTo:"`{got}` is not equal to `{expected}`",needNot:"Need not",isStrictlyEqual:"`{got}` is strictly equal to `{expected}`",needStrictly:"Need strictly",isStrictlyNotEqual:"`{got}` is strictly not equal to `{expected}`",needStrictlyNot:"Need strictly not",alreadyWaiting:"Already waiting with title",
noOngoingWait:"There is no ongoing `wait` action with title",noMatchingEndAsync:"No matching `endAsync` call within",endAsyncMisuse:"Calls to endAsync without argument should only be performed if you have single beginAsync statement",codeBodyMissingForSubTest:"Code body is not provided for sub test",codeBodyMissingTestArg:"Code body of sub test [{name}] does not declare a test instance as 1st argument",Subtest:"Subtest",Test:"Test",failedToFinishWithin:"failed to finish within",threwException:"threw an exception",
testAlreadyStarted:"Test has already been started",setupTookTooLong:"`setup` method took too long to complete",errorBeforeTestStarted:"Error happened before the test started",testStillRunning:"Your test is still considered to be running, if this is unexpected please see console for more information",testNotFinalized:'Your test [{url}] has not finalized, most likely since a timer (setTimeout) is still active. If this is the expected behavior, try setting "overrideSetTimeout : false" on your Harness configuration.',
missingDoneCall:"Test has completed, but there was no `t.done()` call. Add it at the bottom, or use `t.beginAsync()` for asynchronous code",allTestsPassed:"All tests passed","Snoozed until":"Snoozed until",testTearDownTimeout:"Test's tear down process has timeout out"},"Siesta.Recorder.Editor.Code":{invalidSyntax:"Invalid syntax"},"Siesta.Recorder.Editor.DragTarget":{targetLabel:"Target",toLabel:"To",byLabel:"By",cancelButtonText:"Cancel",saveButtonText:"Save",dragVariantTitle:"Edit `drag` action",
moveCursorVariantTitle:"Edit `moveCursor` action"},"Siesta.Recorder.UI.EventView":{actionColumnHeader:"Action",offsetColumnHeader:"Offset"},"Siesta.Recorder.UI.RecorderPanel":{queryMatchesNothing:"Query matches no DOM elements or components",queryMatchesMultiple:"Query matches multiple components",noVisibleElsFound:"No visible elements found for target",noTestDetected:"No test detected",noTestStarted:"You need to run a test first",recordTooltip:"Record",stopTooltip:"Stop",playTooltip:"Play",clearTooltip:"Clear all",
codeWindowTitle:"Code",addNewTooltip:"Add a new step",removeAllPromptTitle:"Remove all?",removeAllPromptMessage:"Do you want to clear the recorded events?",Error:"Error"},"Siesta.Recorder.UI.TargetColumn":{headerText:"Target / Value",by:"by",to:"to"}};
Siesta.Resource=function(){var a=Class({does:Siesta.Util.Role.CanFormatStrings,has:{dict:null},methods:{get:function(a,c){var d=this.dict[a];if(d)return this.formatString(d,c);window.console&&console.error&&window.top.console.error("TEXT_NOT_DEFINED: "+a);return"TEXT_NOT_DEFINED: "+a}}});return function(b,c){var d=Siesta.CurrentLocale[b];if(!d)throw"Missing dictionary for namespace: "+b;d=new a({dict:d,serializeFormatingPlaceholders:!1});return c?d.get(c):d}}();
(function(){var a=0;Class("Siesta.Result",{has:{description:null,children:Joose.I.Array,length:0,id:function(){return++a},parent:null},methods:{itemAt:function(a){return this.children[a]},push:function(a){this.children.push(a);a.parent=this;this.length=this.children.length},each:function(a,c){var d=this.children;if(!1===a.call(c||this,this))return!1;for(var e=0;e<d.length;e++)if(!1===d[e].each(a,c))return!1},eachChild:function(a,c){for(var d=this.children,e=0;e<d.length;e++)if(!1===a.call(c,d[e]))return!1},
toString:function(){return this.description},toJSON:function(){return{type:this.meta.name,description:this.description}},findChildById:function(a){var c;this.each(function(d){if(d.id==a)return c=d,!1});return c}},my:{methods:{seedID:function(b){a=b}}}})})();Class("Siesta.Result.Diagnostic",{isa:Siesta.Result,has:{isWarning:!1},methods:{toString:function(){return"# "+this.description},toJSON:function(){var a={type:this.meta.name,description:this.description};this.isWarning&&(a.isWarning=!0);return a}}});
Class("Siesta.Result.Summary",{isa:Siesta.Result,has:{isFailed:!1},methods:{getTest:function(){return this.parent.test},toString:function(){}}});
Class("Siesta.Result.Assertion",{isa:Siesta.Result,has:{name:null,passed:null,annotation:null,index:null,sourceLine:null,isSkipped:!1,isTodo:!1,isException:!1,exceptionType:null,isWaitFor:!1,completed:!1},methods:{isPassed:function(a){return a?this.passed:this.isTodo||this.isWaitFor&&!this.completed?!0:this.passed},toString:function(){var a=Siesta.Resource("Siesta.Result.Assertion"),a=(this.isTodo?a.get("todoText"):"")+(this.passed?a.get("passText"):a.get("failText"))+" "+this.index+" - "+this.description;
this.annotation&&(a+="\n"+this.annotation);return a},toJSON:function(){var a=this,b={type:this.meta.name,passed:this.passed,description:String(this.description)||"No description",annotation:String(this.annotation)};Joose.A.each(["isTodo","isWaitFor","isException","sourceLine","name"],function(c){a[c]&&(b[c]=a[c])});this.isException&&(b.exceptionType=this.exceptionType);return b}}});
Class("Siesta.Result.SubTest",{isa:Siesta.Result,has:{test:null},methods:{isWorking:function(){return!this.test.isFinished()},toJSON:function(){var a=this.test,b=!(a instanceof Object),c={type:this.meta.name,name:a.name,startDate:a.startDate,endDate:a.endDate||new Date-0,passed:b?null:a.isPassed()};a.parent||(c.url=a.url,c.jUnitClass=a.getJUnitClass(),c.groups=a.groups);a.specType&&(c.bddSpecType=a.specType);var d=!1,e=[];Joose.A.each(this.children,function(a){if(a instanceof Siesta.Result.Assertion||
a instanceof Siesta.Result.Diagnostic||a instanceof Siesta.Result.SubTest)a=a.toJSON(),a.passed||a.isTodo||(d=!0),e.push(a)});c.assertions=e;b&&(c.passed=!(d||a.failed||!a.endDate));return c}}});
Role("Siesta.Test.Function",{methods:{isCalled:function(a,b,c){this.isCalledNTimes(a,b,1,c,!0)},isCalledOnce:function(a,b,c){this.isCalledNTimes(a,b,1,c,!1)},isCalledNTimes:function(a,b,c,d,e){var f=this,g="string"===typeof a?a:f.getPropertyName(b,a),h=0,k=Siesta.Resource("Siesta.Test.Function");d=d?d+" ":"";this.on("beforetestfinalizeearly",function(){h===c||e&&h>c?f.pass(d||g+" "+k.get("methodCalledExactly").replace("{n}",c)):f.fail(d||g,{assertionName:"isCalledNTimes "+g,got:h,need:c,needDesc:k.get("Need")+
" "+(e?k.get("atLeast"):k.get("exactly"))+" "})});a=b[g];b[g]=function(){h++;return a.apply(this,arguments)}},isntCalled:function(a,b,c){this.isCalledNTimes(a,b,0,c)},getPropertyName:function(a,b){for(var c in a)if(a[c]===b)return c},methodIsCalledNTimes:function(a,b,c,d,e){var f=this,g=0,h=Siesta.Resource("Siesta.Test.Function");d=d?d+" ":"";try{"String"==f.typeOf(b)&&(b=f.global.eval(b))}catch(k){f.fail(d,{assertionName:"isMethodCalled",annotation:h.get("exceptionEvalutingClass").replace("{e}",
k)+"["+b+"]"});return}b=b.prototype;var m="string"===typeof a?a:f.getPropertyName(b,a);f.on("beforetestfinalizeearly",function(){g===c||e&&g>c?f.pass(d||m+" "+h.get("methodCalledExactly").replace("{n}",c)):f.fail(d||m,{assertionName:"methodIsCalledNTimes "+m,got:g,need:c,needDesc:h.get("Need")+" "+(e?h.get("atLeast"):h.get("exactly"))+" "})});a=b[m];b[m]=function(){g++;return a.apply(this,arguments)}},methodIsCalled:function(a,b,c){this.methodIsCalledNTimes(a,b,1,c,!0)},methodIsntCalled:function(a,
b,c){this.methodIsCalledNTimes(a,b,0,c)}}});Role("Siesta.Test.Date",{methods:{isDateEq:function(a,b,c){this.isDateEqual.apply(this,arguments)},isDateEqual:function(a,b,c){var d=Siesta.Resource("Siesta.Test.Date");0===a-b?this.pass(c,{descTpl:"{got} "+d.get("isEqualTo")+" {expectedDate}",got:a,expectedDate:b}):this.fail(c,{assertionName:"isDateEqual",got:a?a.toString():"",gotDesc:d.get("Got"),need:b.toString()})}}});
Role("Siesta.Test.More",{requires:["isFailed","typeOf","on"],has:{autoCheckGlobals:!1,expectedGlobals:Joose.I.Array,disableGlobalsCheck:!1,browserGlobals:{init:["console","getInterface","ExtBox1","__IE_DEVTOOLBAR_CONSOLE_COMMAND_LINE",/__BROWSERTOOLS/,"seleniumAlert","_phantom","callPhantom","onload","onerror","StartTest","startTest","__loaderInstrumentationHookInstalled__","describe","setTimeout","clearTimeout","requestAnimationFrame","cancelAnimationFrame","__coverage__",/__cov_\d+/]},waitForTimeout:1E4,
waitForPollInterval:100},methods:{isGreater:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");a>b?this.pass(c,{descTpl:d.get("isGreaterPassTpl"),value1:a,value2:b}):this.fail(c,{assertionName:"isGreater",got:a,need:b,needDesc:d.get("needGreaterThan")})},isLess:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");a<b?this.pass(c,{descTpl:d.get("isLessPassTpl"),value1:a,value2:b}):this.fail(c,{assertionName:"isLess",got:a,need:b,needDesc:d.get("needLessThan")})},isGE:function(){this.isGreaterOrEqual.apply(this,
arguments)},isGreaterOrEqual:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");a>=b?this.pass(c,{descTpl:d.get("isGreaterEqualPassTpl"),value1:a,value2:b}):this.fail(c,{assertionName:"isGreaterOrEqual",got:a,need:b,needDesc:d.get("needGreaterEqualTo")})},isLE:function(){this.isLessOrEqual.apply(this,arguments)},isLessOrEqual:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");a<=b?this.pass(c,{descTpl:d.get("isLessEqualPassTpl"),value1:a,value2:b}):this.fail(c,{assertionName:"isLessOrEqual",
got:a,need:b,needDesc:d.get("needLessEqualTo")})},isApprox:function(a,b,c,d){var e=Siesta.Resource("Siesta.Test.More");2==arguments.length&&(c=Math.abs(0.05*a));3==arguments.length&&"String"==this.typeOf(c)&&(d=c,c=Math.abs(0.05*a));Math.abs(function(a,b){var c=function(a){return(a=(a+"").split(".")[1])&&a.length||0},c=Math.max(c(a),c(b)),c=Math.pow(10,c);return(a*c-b*c)/c}(b,a))<=c?this.pass(d,{descTpl:e.get("isApproxToPassTpl"),value1:a,value2:b,annotation:b==a?e.get("exactMatch"):e.get("withinThreshold")+
": "+c}):this.fail(d,{assertionName:"isApprox",got:a,need:b,needDesc:e.get("needApprox"),annotation:e.get("thresholdIs")+": "+c})},like:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(b)?a.match(b)?this.pass(c,{descTpl:d.get("stringMatchesRe"),string:a,regex:b}):this.fail(c,{assertionName:"like",got:a,need:b,needDesc:d.get("needStringMatching")}):-1!=a.indexOf(b)?this.pass(c,{descTpl:d.get("stringHasSubstring"),string:a,regex:b}):this.fail(c,{assertionName:"like",got:a,
need:b,needDesc:d.get("needStringContaining")})},unlike:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(b)?a.match(b)?this.fail(c,{assertionName:"unlike",got:a,need:b,needDesc:d.get("needStringNotMatching")}):this.pass(c,{descTpl:d.get("stringNotMatchesRe"),string:a,regex:b}):-1==a.indexOf(b)?this.pass(c,{descTpl:d.get("stringHasNoSubstring"),string:a,regex:b}):this.fail(c,{assertionName:"unlike",got:a,need:b,needDesc:d.get("needStringNotContaining")})},"throws":function(){this.throwsOk.apply(this,
arguments)},throws_ok:function(){this.throwsOk.apply(this,arguments)},throwsOk:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");if("Function"!=this.typeOf(a))throw Error(d.get("throwsOkInvalid"));a=this.getExceptionCatcher()(a);void 0===a?this.fail(c,{assertionName:"throws_ok",annotation:d.get("didntThrow")}):(a instanceof this.getTestErrorClass()&&(a=a.message||a.description),a=""+a,"RegExp"==this.typeOf(b)?a.match(b)?this.pass(c,{descTpl:d.get("exMatchesRe"),expected:b}):this.fail(c,{assertionName:"throws_ok",
got:a,gotDesc:d.get("exceptionStringifiesTo"),need:b,needDesc:d.get("needStringMatching")}):-1!=a.indexOf(b)?this.pass(c,{descTpl:d.get("exContainsSubstring"),expected:b}):this.fail(c,{assertionName:"throws_ok",got:a,gotDesc:d.get("exceptionStringifiesTo"),need:b,needDesc:d.get("needStringContaining")}))},lives_ok:function(){this.livesOk.apply(this,arguments)},lives:function(){this.livesOk.apply(this,arguments)},livesOk:function(a,b){"Function"!=this.typeOf(a)&&(a=[b,b=a][0]);var c=Siesta.Resource("Siesta.Test.More"),
d=this.getExceptionCatcher()(a);void 0===d?this.pass(b,{descTpl:c.get("fnDoesntThrow")}):this.fail(b,{assertionName:"lives_ok",annotation:c.get("fnThrew")+": "+d})},isa_ok:function(a,b,c){this.isInstanceOf(a,b,c)},isaOk:function(a,b,c){this.isInstanceOf(a,b,c)},isInstanceOf:function(a,b,c){var d=Siesta.Resource("Siesta.Test.More");try{"String"==this.typeOf(b)&&(b=this.global.eval(b))}catch(e){this.fail(c,{assertionName:"isa_ok",annotation:Siesta.Resource("Siesta.Test.Function","exceptionEvalutingClass")});
return}a instanceof b?this.pass(c,{descTpl:d.get("isInstanceOfPass")}):this.fail(c,{assertionName:"isa_ok",got:a,need:String(b),needDesc:d.get("needInstanceOf")})},isString:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"String"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isAString"),value:a}):this.fail(b,{got:a,need:c.get("aStringValue")})},isObject:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"Object"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isAnObject"),value:a}):this.fail(b,
{got:a,need:c.get("anObject")})},isArray:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"Array"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isAnArray"),value:a}):this.fail(b,{got:a,need:c.get("anArrayValue")})},isNumber:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"Number"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isANumber"),value:a}):this.fail(b,{got:a,need:c.get("aNumberValue")})},isBoolean:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"Boolean"==this.typeOf(a)?
this.pass(b,{descTpl:c.get("isABoolean"),value:a}):this.fail(b,{got:a,need:c.get("aBooleanValue")})},isDate:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"Date"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isADate"),value:a}):this.fail(b,{got:a,need:c.get("aDateValue")})},isRegExp:function(a,b){var c=Siesta.Resource("Siesta.Test.More");"RegExp"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isARe"),value:a}):this.fail(b,{got:a,need:c.get("aReValue")})},isFunction:function(a,b){var c=Siesta.Resource("Siesta.Test.More");
"Function"==this.typeOf(a)?this.pass(b,{descTpl:c.get("isAFunction"),value:a}):this.fail(b,{got:a,need:c.get("aFunctionValue")})},is_deeply:function(a,b,c){this.isDeeply.apply(this,arguments)},isDeeply:function(a,b,c){if(this.typeOf(a)===this.typeOf(b)&&this.compareObjects(a,b)){var d=Siesta.Resource("Siesta.Test.More");this.pass(c,{descTpl:d.get("isDeeplyPassTpl"),obj1:a,obj2:b})}else this.fail(c,{assertionName:"isDeeply",got:a,need:b})},isDeeplyStrict:function(a,b,c){if(this.typeOf(a)===this.typeOf(b)&&
this.compareObjects(a,b,!0)){var d=Siesta.Resource("Siesta.Test.More");this.pass(c,{descTpl:d.get("isDeeplyStrictPassTpl"),obj1:a,obj2:b})}else this.fail(c,{assertionName:"isDeeplyStrict",got:a,need:b})},expectGlobal:function(){this.expectGlobals.apply(this,arguments)},expectGlobals:function(){this.expectedGlobals.push.apply(this.expectedGlobals,arguments)},isGlobalExpected:function(a,b){var c=this;if(!b||b&&!b.expectedStrings)b||(b={}),Joose.O.extend(b,{expectedStrings:{},expectedRegExps:[]}),Joose.A.each(this.expectedGlobals.concat(this.browserGlobals),
function(a){"RegExp"==c.typeOf(a)?b.expectedRegExps.push(a):b.expectedStrings[a]=!0});if(b.expectedStrings[a])return!0;if(Siesta.Harness.Browser.FeatureSupport().supports.imageWithIdCreatesGlobalEnumerable){var d=this.global.document.getElementById(a);if(d&&"img"==d.tagName.toLowerCase())return!0}for(d=0;d<b.expectedRegExps.length;d++)if(b.expectedRegExps[d].test(a))return!0;return!1},forEachUnexpectedGlobal:function(a,b){b=b||this;var c={},d;for(d in this.global)this.isGlobalExpected(d,c)||a.call(b,
d)},verifyGlobals:function(){var a=Siesta.Resource("Siesta.Test.More");if(this.disableGlobalsCheck)this.diag(a.get("globalCheckNotSupported"));else{this.expectGlobals.apply(this,arguments);this.diag(a.get("globalVariables"));var b=!1;this.forEachUnexpectedGlobal(function(c){this.fail(a.get("globalFound"),a.get("globalName")+": "+c+", "+a.get("value")+": "+Siesta.Util.Serializer.stringify(this.global[c]));b=!0});b||this.pass(a.get("noGlobalsFound"))}},startWaiting:function(a,b){var c=new Siesta.Result.Assertion({description:a,
isWaitFor:!0,sourceLine:b});this.fireEvent("testupdate",this,c,this.getResults());return c},finalizeWaiting:function(a,b,c,d,e){a.completed=!0;b?this.pass(c,d,a):(this.fail(c,d,a),e&&e())},waitFor:function(a,b,c,d,e){var f=Siesta.Resource("Siesta.Test.More"),g=" "+f.get("conditionToBeFulfilled"),h="waitFor",k=this,m=k.getSourceLine(),r=k.originalSetTimeout,s=k.originalClearTimeout,v;if(1===arguments.length&&"Object"==this.typeOf(a)){var l=a;a=l.method;b=l.callback;c=l.scope;d=l.timeout;e=l.interval;
g=l.description||g;h=l.assertionName||h;v=l.errback}l="Number"==this.typeOf(a);b=b||function(){};var g=l?a+" "+f.get("ms"):g,t,p=k.startWaiting(f.get("waitingFor")+" "+g,m);e=e||this.waitForPollInterval;d=d||this.waitForTimeout;var q=this.beginAsync((l?a:d)+3*e,function(){s(t);k.finalizeWaiting(p,!1,f.get("waitedTooLong")+": "+g,{assertionName:h,annotation:f.get("conditionNotFulfilled")+" "+d+f.get("ms")},v);return!0}),n=!1;this.on("beforetestfinalize",function(){n||(n=!0,k.finalizeWaiting(p,!1,f.get("waitingAborted")),
k.endAsync(q),s(t))},null,{single:!0});if(l)t=r(function(){n=!0;k.finalizeWaiting(p,!0,f.get("Waited")+" "+a+" "+f.get("ms"));k.endAsync(q);k.processCallbackFromTest(b,[],c||k)},a);else{var u,w=new Date,x=function(){var m=new Date-w;if(m>d)k.endAsync(q),k.finalizeWaiting(p,!1,f.get("waitedTooLong")+": "+g,{assertionName:h,annotation:f.get("conditionNotFulfilled")+" "+d+f.get("ms")},v),n=!0;else{try{u=a.call(c||k)}catch(l){k.endAsync(q);k.finalizeWaiting(p,!1,h+" "+f.get("checkerException"),{assertionName:h,
got:l.toString(),gotDesc:f.get("Exception")},v);n=!0;return}null!=u&&!1!==u?(k.endAsync(q),n=!0,k.finalizeWaiting(p,!0,f.get("Waited")+" "+m+" "+f.get("msFor")+" "+g),k.processCallbackFromTest(b,[u],c||k)):t=r(x,e)}};x()}return{force:function(){n||(n=!0,s(t),k.endAsync(q),k.finalizeWaiting(p,!0,f.get("forcedWaitFinalization")+" "+g),k.processCallbackFromTest(b,[],c||k))}}},waitForMs:function(){return this.waitFor.apply(this,arguments)},waitForFn:function(){return this.waitFor.apply(this,arguments)},
analyzeChainStep:function(a){a=a.toString();var b=a.match(/function\s*[^(]*\(\s*(.*?)\s*(?:,|\))/)[1];return b?-1!=a.match(/\{([\s\S]*)\}/)[1].indexOf(b):!1},chain:function(){var a=this.flattenArray(arguments),b=Siesta.Resource("Siesta.Test.More"),c=[];Joose.A.each(a,function(a){a&&c.push(a)});var a=c,d=a.length;if(d){var e=this,f=arguments.callee,g=new Siesta.Util.Queue({deferer:this.originalSetTimeout,deferClearer:this.originalClearTimeout,interval:f.hasOwnProperty("actionDelay")?f.actionDelay:
this.actionDelay,observeTest:this});delete f.actionDelay;var h=e.getSourceLine(),k=[];Joose.A.each(a,function(a,c){var f=c==d-1;g.addAsyncStep({processor:function(d){var g="wait"==a.action||a.waitFor||a instanceof Siesta.Test;if(!g)var t=e.beginAsync((a.timeout||e.defaultTimeout)+100,function(){e.fail(b.get("chainStepNotCompleted"),{sourceLine:h,annotation:b.get("stepNumber")+": "+(c+1)+" "+b.get("oneBased")+(h?"\n"+b.get("atLine")+": "+h:""),ownTextOnly:!0});return!0});var p=function(){var f=arguments.callee;
f.__CALLED__&&e.fail(b.get("calledMoreThanOnce",{num:c+1,line:h}));f.__CALLED__=!0;g||e.endAsync(t);k=Array.prototype.slice.call(arguments);a.desc&&e.pass(a.desc);d.next()};if(a instanceof Siesta.Test)e.launchSubTest(a,p);else if("Function"==e.typeOf(a)||"Function"==e.typeOf(a.action)){var q="Function"==e.typeOf(a)?a:a.action;k.unshift(f?function(){}:p);f||e.analyzeChainStep(q)||e.fail(b.get("stepFn")+" ["+q.toString()+"] "+b.get("notUsingNext"));e.transparentEx?q.apply(e,k):(p=e.getExceptionCatcher()(function(){q.apply(e,
k)}),void 0!==p&&e.fail(b.get("chainStepEx"),{annotation:e.stringifyException(p)}));f&&e.endAsync(t)}else"String"==e.typeOf(a)?p=new Siesta.Test.Action.Eval({actionString:a,next:p,test:e}):(a.next=p,a.test=e,p=Siesta.Test.ActionRegistry().create(a,e,k)),p.process()}})});g.run()}},chainForArray:function(a,b,c,d){var e=this,f=[];Joose.A[d?"eachR":"each"](a,function(a,c){var d=b.call(e,a,c);"Array"==e.typeOf(d)?f.push.apply(f,d):d&&f.push(d)});c&&f.push(function(){e.processCallbackFromTest(c)});this.chain(f)},
verifyExpectedNumber:function(a,b){var c="==";if("String"==this.typeOf(b)){var d=/([<>=]=?)\s*(\d+)/.exec(b),c=Siesta.Resource("Siesta.Test.Browser");if(!d)throw Error(c.get("wrongFormat")+": "+b);c=d[1];b=Number(d[2])}switch(c){case "==":return a==b;case "<=":return a<=b;case ">=":return a>=b;case "<":return a<b;case ">":return a>b}}},after:{initialize:function(){this.on("beforetestfinalize",function(){!this.autoCheckGlobals||(this.isFailed()||this.parent)||this.verifyGlobals()},this)}}});
Role("Siesta.Test.Role.Placeholder",{requires:["equalsTo"]});
Class("Siesta.Test.BDD.Spy",{does:[Siesta.Util.Role.CanGetType],has:{name:null,processor:{lazy:"this.buildProcessor"},hostObject:null,propertyName:null,hasOwnOriginalValue:!1,originalValue:null,strategy:"returnValue",returnValueObj:void 0,fakeFunc:null,throwErrorObj:null,callsLog:Joose.I.Array,calls:null,t:null,and:function(){return this}},methods:{initialize:function(){var a=this;this.calls={any:function(){return 0<a.callsLog.length},count:function(){return a.callsLog.length},argsFor:function(b){return a.callsLog[b].args},
allArgs:function(b){return Joose.A.map(a.callsLog,function(a){return a.args})},all:function(){return a.callsLog},mostRecent:function(){return a.callsLog[a.callsLog.length-1]},first:function(){return a.callsLog[0]},reset:function(){a.reset()}};var b=Siesta.Resource("Siesta.Test.BDD.Spy"),c=this.hostObject,d=this.propertyName;if(c){if("Function"!=this.typeOf(c[d]))throw b.get("spyingNotOnFunction");this.hasOwnOriginalValue=c.hasOwnProperty(d);this.originalValue=c[d];this.originalValue.__SIESTA_SPY__&&
this.originalValue.__SIESTA_SPY__.remove();c[d]=this.getProcessor()}this.t&&this.t.spies.push(this)},buildProcessor:function(){var a=this,b=function(){var b=Array.prototype.slice.call(arguments),d={object:this,args:b};a.callsLog.push(d);return d.returnValue=a[a.strategy+"Strategy"](this,b)};b.__SIESTA_SPY__=b.and=a;b.calls=a.calls;return b},returnValueStrategy:function(a,b){return this.returnValueObj},callThroughStrategy:function(a,b){return this.originalValue.apply(a,b)},callFakeStrategy:function(a,
b){return this.fakeFunc.apply(a,b)},throwErrorStrategy:function(a,b){var c=this.throwErrorObj,d=this.t&&this.t.global?this.t.global.Error:Error;c instanceof d||(c=new d(c));throw c;},callThrough:function(){if(!this.hostObject)throw"Need the host object to call through to original method";this.strategy="callThrough";return this},stub:function(){this.returnValue();return this},returnValue:function(a){this.strategy="returnValue";this.returnValueObj=a;return this},callFake:function(a){this.strategy="callFake";
this.fakeFunc=a;return this},throwError:function(a){this.strategy="throwError";this.throwErrorObj=a;return this},remove:function(){var a=this.hostObject;a&&(this.hasOwnOriginalValue?a[this.propertyName]=this.originalValue:delete a[this.propertyName]);this.originalValue=this.hostObject=null;this.callsLog=[];this.returnValueObj=this.fakeFunc=this.throwErrorObj=null;a=this.getProcessor();this.processor=a.and=a.calls=a.__SIESTA_SPY__=null},reset:function(){this.callsLog=[]}}});
Class("Siesta.Test.BDD.Placeholder",{does:Siesta.Test.Role.Placeholder,has:{clsConstructor:{required:!0},t:null,context:null,globals:{init:"String Boolean Number Date RegExp Function Array Object".split(" ")}},methods:{getClassName:function(a){var b=this.getClassConstructor(),c=this.context,d;Joose.A.each(this.globals,function(a){if(b==c[a])return d=a,!1});return a?d:d||(b?b+"":"")},getClassConstructor:function(){return this.clsConstructor},equalsTo:function(a){var b=this.getClassConstructor();if(!b)return!0;
if(a instanceof Siesta.Test.BDD.Placeholder){var c=this.getClassName(!0);return"Object"!=a.getClassName(!0)||"Date"!=c&&"RegExp"!=c&&"Function"!=c&&"Array"!=c?b==a.getClassConstructor():!0}var c=!1,d=this.getClassName(!0);d&&(c=this.t.typeOf(a)==d||a instanceof this.context[d]);return c||a instanceof b},toString:function(){return"any "+(this.getClassName()||"value")}}});
Class("Siesta.Test.BDD.NumberPlaceholder",{does:Siesta.Test.Role.Placeholder,has:{value:{required:!0},threshold:null},methods:{initialize:function(){null==this.threshold&&(this.threshold=0.05*this.value)},equalsTo:function(a){return Math.abs(a-this.value)<=this.threshold},toString:function(){return"any number approximately equal to "+this.value}}});
Class("Siesta.Test.BDD.StringPlaceholder",{does:Siesta.Test.Role.Placeholder,has:{value:{required:!0}},methods:{equalsTo:function(a){return"[object RegExp]"==Object.prototype.toString(this.value)?this.value.test(a):-1<String(a).indexOf(this.value)},toString:function(){return"[object RegExp]"==Object.prototype.toString(this.value)?"any string matching: "+this.value:"any string containing: "+this.value}}});
Class("Siesta.Test.BDD.Expectation",{does:[Siesta.Util.Role.CanGetType],has:{value:null,isNot:!1,not:null,t:null},methods:{initialize:function(){this.isNot||(this.not=new this.constructor({isNot:!0,t:this.t,value:this.value}))},process:function(a,b){var c=this.isNot;b=b||{};b.not=b.not||c?"not ":"";b.got=b.hasOwnProperty("got")?b.got:this.value;b.noGot&&delete b.got;var d=b.assertionName;d&&c&&(b.assertionName=d.replace(/^(expect\(.+?\)\.)/,"$1not."));this.t[(c?!a:a)?"pass":"fail"](null,b)},toBe:function(a){var b=
Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,a,!0,!0),{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toBeText")+" {need}",assertionName:"expect(got).toBe(need)",need:a,needDesc:this.isNot?b.get("needNotText"):b.get("needText")})},toEqual:function(a){var b=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,a,!0),{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toBeEqualToText")+" {need}",assertionName:"expect(got).toEqual(need)",
need:a,needDesc:this.isNot?b.get("needNotText"):b.get("needText")})},toBeNull:function(){var a=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.t.compareObjects(this.value,null,!0,!0),{descTpl:a.get("expectText")+" {got} {!not}"+a.get("toBeText")+" null",assertionName:"expect(got).toBeNull()",need:null,needDesc:this.isNot?a.get("needNotText"):a.get("needText")})},toBeNaN:function(){var a=this.value,b=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process("Number"==this.t.typeOf(a)&&
a!=a,{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toBeText")+" NaN",assertionName:"expect(got).toBeNaN()",need:NaN,needDesc:this.isNot?b.get("needNotText"):b.get("needText")})},toBeDefined:function(){var a=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(void 0!==this.value,{descTpl:a.get("expectText")+" {got} {!not}"+a.get("toBeDefinedText"),assertionName:"expect(got).toBeDefined()"})},toBeUndefined:function(a){a=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(void 0===
this.value,{descTpl:a.get("expectText")+" {got} {!not}"+a.get("toBeUndefinedText"),assertionName:"expect(got).toBeUndefined()"})},toBeTruthy:function(){var a=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value,{descTpl:a.get("expectText")+" {got} {!not}"+a.get("toBeTruthyText"),assertionName:"expect(got).toBeTruthy()"})},toBeFalsy:function(){var a=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(!this.value,{descTpl:a.get("expectText")+" {got} {!not}"+a.get("toBeFalsyText"),
assertionName:"expect(got).toBeFalsy()"})},toMatch:function(a){var b=Siesta.Resource("Siesta.Test.BDD.Expectation");if("RegExp"!=this.t.typeOf(a))throw Error("`expect().toMatch()` matcher expects a regular expression");this.process(RegExp(a).test(this.value),{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toMatchText")+" {need}",assertionName:"expect(got).toMatch(need)",need:a,needDesc:this.isNot?b.get("needNotMatchingText"):b.get("needMatchingText")})},toContain:function(a){var b=this.value,
c=this.t,d=Siesta.Resource("Siesta.Test.BDD.Expectation"),e=!1;if("String"==c.typeOf(b))this.process(0<=b.indexOf(a),{descTpl:d.get("expectText")+" {got} {!not}"+d.get("toContainText")+" {need}",assertionName:"expect(got).toContain(need)",need:a,needDesc:this.isNot?d.get("needStringNotContainingText"):d.get("needStringContainingText")});else{for(var b=Array.prototype.slice.call(b),f=0;f<b.length;f++)if(c.compareObjects(a,b[f],!0)){e=!0;break}this.process(e,{descTpl:d.get("expectText")+" {got} {!not}"+
d.get("toContainText")+" {need}",assertionName:"expect(got).toContain(need)",need:a,needDesc:this.isNot?d.get("needArrayNotContainingText"):d.get("needArrayContainingText")})}},toBeLessThan:function(a){var b=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value<a,{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toBeLessThanText")+" {need}",assertionName:"expect(got).toBeLessThan(need)",need:a,needDesc:this.isNot?b.get("needGreaterEqualThanText"):b.get("needLessThanText")})},toBeGreaterThan:function(a){var b=
Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(this.value>a,{descTpl:b.get("expectText")+" {got} {!not}"+b.get("toBeGreaterThanText")+" {need}",assertionName:"expect(got).toBeGreaterThan(need)",need:a,needDesc:this.isNot?b.get("needLessEqualThanText"):b.get("needGreaterThanText")})},toBeCloseTo:function(a,b){var c=Math.pow(10,-(null!=b?b:2))/2,d=Math.abs(this.value-a),e=Siesta.Resource("Siesta.Test.BDD.Expectation");this.process(d<c,{descTpl:e.get("expectText")+" {got} {!not}"+e.get("toBeCloseToText")+
" {need}",assertionName:"expect(got).toBeCloseTo(need)",need:a,needDesc:this.isNot?e.get("needValueNotCloseToText"):e.get("needValueCloseToText"),annotation:d?e.get("thresholdIsText")+c:e.get("exactMatchText")})},toThrow:function(){var a=this.value,b=this.t,c=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"!=b.typeOf(a))throw Error("`expect().toMatch()` matcher expects a function");a=b.getExceptionCatcher()(a);a instanceof b.getTestErrorClass()&&(a=a.message||a.description);this.process(void 0!==
a,{descTpl:c.get("expectText")+" function {!not}"+c.get("toThrowText"),assertionName:"expect(func).toThrow()",annotation:a?c.get("thrownExceptionText")+": "+Siesta.Util.Serializer.stringify(a):c.get("noExceptionThrownText"),noGot:!0})},toHaveBeenCalled:function(a){a=null!=a?a:">=1";var b=this.value,c=this.t,d=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"==this.typeOf(b)){if(!b.__SIESTA_SPY__)throw Error(d.get("wrongSpy"));b=b.__SIESTA_SPY__}if(!(b instanceof Siesta.Test.BDD.Spy))throw Error(d.get("wrongSpy"));
this.process(c.verifyExpectedNumber(b.callsLog.length,a),{descTpl:d.get("toHaveBeenCalledDescTpl"),assertionName:"expect(func).toHaveBeenCalled()",methodName:b.propertyName,got:b.callsLog.length,gotDesc:d.get("actualNbrOfCalls"),need:a,needDesc:d.get("expectedNbrOfCalls")})},toHaveBeenCalledWith:function(){var a=this.value,b=this.t,c=Siesta.Resource("Siesta.Test.BDD.Expectation");if("Function"==this.typeOf(a)){if(!a.__SIESTA_SPY__)throw Error(c.get("wrongSpy"));a=a.__SIESTA_SPY__}if(!(a instanceof
Siesta.Test.BDD.Spy))throw Error(c.get("wrongSpy"));var d=Array.prototype.slice.call(arguments),e=!1;Joose.A.each(a.callsLog,function(a){if(b.compareObjects(a.args,d))return e=!0,!1});this.process(e,{descTpl:c.get("toHaveBeenCalledWithDescTpl"),assertionName:"expect(func).toHaveBeenCalledWith()",methodName:a.propertyName,noGot:!0})}}});
Role("Siesta.Test.BDD",{requires:["getSubTest","chain"],has:{specType:null,beforeEachHooks:Joose.I.Array,afterEachHooks:Joose.I.Array,sequentialSubTests:Joose.I.Array,codeProcessed:!1,launchTimeout:null,expectationClass:Siesta.Test.BDD.Expectation,failOnExclusiveSpecsWhenAutomated:!1,spies:Joose.I.Array},methods:{checkSpecFunction:function(a,b,c){if(!a)throw Error(Siesta.Resource("Siesta.Test.BDD","codeBodyMissing")+" "+("describe"==b?"suite":"spec")+" ["+c+"]");if(!a.length)throw Error(Siesta.Resource("Siesta.Test.BDD",
"codeBodyOf")+" "+("describe"==b?"suite":"spec")+" ["+c+"] "+Siesta.Resource("Siesta.Test.BDD","missingFirstArg"));},ddescribe:function(a,b,c){this.describe(a,b,c,!0)},xdescribe:function(){},describe:function(a,b,c,d){this.checkSpecFunction(b,"describe",a);a=this.getSubTest({name:a,run:b,isExclusive:d,specType:"describe",timeout:c});this.codeProcessed&&this.scheduleSpecsLaunch();this.sequentialSubTests.push(a)},iit:function(a,b,c){this.harness.isAutomated&&this.failOnExclusiveSpecsWhenAutomated&&
this.fail(Siesta.Resource("Siesta.Test.BDD","iitFound"));this.it(a,b,c,!0)},xit:function(){},it:function(a,b,c,d){this.checkSpecFunction(b,"it",a);a=this.getSubTest({name:a,run:b,isExclusive:d,specType:"it",timeout:c});this.codeProcessed&&this.scheduleSpecsLaunch();this.sequentialSubTests.push(a)},expect:function(a){return new this.expectationClass({t:this,value:a})},any:function(a){return new Siesta.Test.BDD.Placeholder({clsConstructor:a,t:this,context:this.global})},anyNumberApprox:function(a,b){return new Siesta.Test.BDD.NumberPlaceholder({value:a,
threshold:b})},anyStringLike:function(a){return new Siesta.Test.BDD.StringPlaceholder({value:a})},scheduleSpecsLaunch:function(){if(!this.launchTimeout){var a=this.beginAsync(),b=this.originalSetTimeout,c=this;this.launchTimeout=b(function(){c.endAsync(a);c.launchTimeout=null;c.launchSpecs()},0)}},runBeforeSpecHooks:function(a){var b=this,c=function(a){b.chainForArray(b.beforeEachHooks,function(a){return a.isAsync?a.code:function(b){a.code();b()}},a)};this.parent?this.parent.runBeforeSpecHooks(function(){c(a)}):
c(a)},runAfterSpecHooks:function(a){var b=this;b.chainForArray(this.afterEachHooks,function(a){return a.isAsync?a.code:function(b){a.code();b()}},function(){b.parent?b.parent.runAfterSpecHooks(a):a()},!0)},launchSpecs:function(){var a=this,b=this.sequentialSubTests;this.sequentialSubTests=[];this.chain.actionDelay=0;var c=[];Joose.A.each(b,function(a){a.isExclusive&&c.push(a)});this.chainForArray(c.length?c:b,function(b){return["it"==b.specType?function(b){a.runBeforeSpecHooks(b)}:null,b,"it"==b.specType?
function(b){a.runAfterSpecHooks(b)}:null]})},beforeEach:function(a,b){this.beforeEachHooks.push({code:a,isAsync:b})},afterEach:function(a,b){this.afterEachHooks.push({code:a,isAsync:b})},spyOn:function(a,b){var c=Siesta.Resource("Siesta.Test.BDD");if(a)return new Siesta.Test.BDD.Spy({name:b,t:this,hostObject:a,propertyName:b});this.warn(c.get("noObject"))},createSpy:function(a){return(new Siesta.Test.BDD.Spy({name:a||"James Bond",t:this})).getProcessor()},createSpyObj:function(a,b){1==arguments.length&&
(b=a,a=null);a=a||"spyObject";var c=this,d={};Joose.A.each(b,function(b){d[b]=c.createSpy(a)});return d}},override:{onTestFinalize:function(){Joose.A.each(this.spies,function(a){a.remove()});this.spies=null;this.SUPER()},afterLaunch:function(){this.codeProcessed=!0;this.launchSpecs();this.SUPERARG(arguments)}}});
Role("Siesta.Test.Sub",{has:{isExclusive:!1,parent:{required:!0}},methods:{getExceptionCatcher:function(){return this.parent.getExceptionCatcher()},getTestErrorClass:function(){return this.parent.getTestErrorClass()},getStartTestAnchor:function(){return this.parent.getStartTestAnchor()},expectGlobals:function(){return this.parent.expectGlobals.apply(this.parent,arguments)}}});
Class("Siesta.Test",{does:[Siesta.Util.Role.CanFormatStrings,Siesta.Util.Role.CanGetType,Siesta.Test.More,Siesta.Test.Date,Siesta.Test.Function,Siesta.Test.BDD,JooseX.Observable],has:{name:null,url:{required:!0},urlExtractRegex:{is:"rwc",lazy:function(){return RegExp(this.url.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")+":(\\d+)")}},assertPlanned:null,assertCount:0,isTodo:!1,results:{lazy:function(){return new Siesta.Result.SubTest({description:this.name||"Root",test:this})}},run:null,startTestAnchor:null,
exceptionCatcher:null,testErrorClass:null,generation:function(){return Math.random()},parent:null,harness:null,isReadyTimeout:1E4,failed:!1,failedException:null,failedExceptionType:null,startDate:null,endDate:null,lastActivityDate:null,contentManager:null,scopeProvider:null,global:null,reusingSandbox:!1,sandboxCleanup:!0,scriptScopeProvider:null,transparentEx:!1,needDone:!1,isDone:!1,defaultTimeout:15E3,subTestTimeout:null,timeout:null,timeoutsCount:function(){return{counter:1}},timeoutIds:Joose.I.Object,
idsToIndex:Joose.I.Object,waitTitles:Joose.I.Object,processed:!1,finalizationStarted:!1,callback:null,nbrExceptions:0,testEndReported:!1,needToCleanup:!0,overrideSetTimeout:!1,overrideForSetTimeout:null,overrideForClearTimeout:null,originalSetTimeout:null,originalClearTimeout:null,sourceLineForAllAssertions:!1,$passCount:null,$failCount:null,actionableMethods:{lazy:"buildActionableMethods"},jUnitClass:null,groups:null,config:null},methods:{initialize:function(){this.on("teststart",function(a){this.parent&&
a.stopPropagation()});this.on("testfinalize",function(a){this.parent&&a.stopPropagation()});this.on("beforetestfinalize",function(a){this.parent&&a.stopPropagation()});this.on("beforetestfinalizeearly",function(a){this.parent&&a.stopPropagation()});this.subTestTimeout=this.subTestTimeout||2*this.defaultTimeout;this.config&&Joose.O.extend(this,this.config)},isReady:function(){var a=Siesta.Resource("Siesta.Test");this.run=this.run||this.getStartTestAnchor().args&&this.getStartTestAnchor().args[0];return{ready:"Function"==
this.typeOf(this.run),reason:a.get("noCodeProvidedToTest")}},isFromTheSameGeneration:function(a){return this.generation==a.generation},toString:function(){return this.url},plan:function(a){if(null!=this.assertPlanned)throw Error("Test plan can't be changed");this.assertPlanned=a},addResult:function(a){var b=a instanceof Siesta.Result.Assertion;b&&(a.isTodo=this.isTodo);if(b&&((this.isDone||this.isFinished())&&!a.isTodo)&&!this.testEndReported){this.testEndReported=!0;var c=Siesta.Resource("Siesta.Test");
this.fail(c.get("addingAssertionsAfterDone"))}b&&!a.index&&(a.index=++this.assertCount);this.getResults().push(a);this.$passCount=this.$failCount=null;this.fireEvent("testupdate",this,a,this.getResults());this.lastActivityDate=new Date},diag:function(a){this.addResult(new Siesta.Result.Diagnostic({description:String(a||"")}))},pass:function(a,b,c){b&&"String"!=this.typeOf(b)&&(!a&&b.descTpl&&(a=this.formatString(b.descTpl,b)),b=b.annotation);c&&(c.passed=!0,c.description=String(a||""),c.annotation=
b);this.addResult(c||new Siesta.Result.Assertion({passed:!0,annotation:String(b||""),description:String(a||""),sourceLine:c&&c.sourceLine||b&&b.sourceLine||this.sourceLineForAllAssertions&&this.getSourceLine()||null}))},fail:function(a,b,c){var d=c&&c.sourceLine||b&&b.sourceLine||this.getSourceLine(),e="";if(b&&"String"!=this.typeOf(b)){!a&&b.descTpl&&(a=this.formatString(b.descTpl,b));var f=[],g=b,h=g.hasOwnProperty("got"),k=g.hasOwnProperty("need"),m=g.gotDesc||"Got",r=g.needDesc||"Need",e=g.assertionName;
b=g.annotation;g.ownTextOnly||!e&&!d||f.push("Failed assertion "+(e?"`"+e+"` ":"")+this.formatSourceLine(d));if(h&&k)var s=Math.max(m.length,r.length),m=this.appendSpaces(m,s-m.length+1),r=this.appendSpaces(r,s-r.length+1);h&&f.push(m+": "+Siesta.Util.Serializer.stringify(g.got));k&&f.push(r+": "+Siesta.Util.Serializer.stringify(g.need));b&&f.push(b);b=f.join("\n")}c&&(c.name=e,c.passed=!1,c.annotation=b,c.description=a);this.addResult(c||new Siesta.Result.Assertion({name:e,passed:!1,sourceLine:d,
annotation:String(b||""),description:String(a||"")}));if(!this.isTodo&&(this.harness.debuggerOnFail&&eval("debugger"),this.harness.breakOnFail))throw a=Siesta.Resource("Siesta.Test"),this.finalize(!0),a.get("testFailedAndAborted");},getSource:function(){return this.contentManager.getContentOf(this.url)},getSourceLine:function(){try{throw Error();}catch(a){if(a.stack){var b=a.stack.match(this.urlExtractRegex());if(b)return b[1]}return null}},getStartTestAnchor:function(){return this.startTestAnchor},
getExceptionCatcher:function(){return this.exceptionCatcher},getTestErrorClass:function(){return this.testErrorClass},processCallbackFromTest:function(a,b,c){var d=this;if(!a)return!0;if(this.transparentEx)a.apply(c||this.global,b||[]);else{var e=this.getExceptionCatcher()(function(){a.apply(c||d.global,b||[])});if(e)return this.failWithException(e),!1}return!0},getStackTrace:function(a){if(Object(a)!==a||!a.stack)return null;for(var b=a.stack+"",c=/^@/.test(b),b=b.split("\n"),d=Siesta.Resource("Siesta.Test"),
e=[],f,g=0;g<b.length;g++)if(b[g]){if(!g)if(c)e.push(a+"");else{e.push(b[g]);continue}if(c){f=/(.*?):(\d+):(\d+)$/.exec(b[g]);if(!f)return null;e.push("    "+d.get("atLine")+" "+f[2]+" "+d.get("of")+" "+f[1])}else{f=/\s*at\s(.*?):(\d+):(\d+)/.exec(b[g]);if(!f)return null;e.push("    "+d.get("atLine")+" "+f[2]+", "+d.get("character")+" "+f[3]+", "+d.get("of")+" "+f[1])}}return e.length?e:null},formatSourceLine:function(a){var b=Siesta.Resource("Siesta.Test");return a?b.get("atLine")+" "+a+" "+b.get("of")+
" "+this.url:""},appendSpaces:function(a,b){for(var c="";b--;)c+=" ";return a+c},eachAssertion:function(a,b){b=b||this;this.getResults().each(function(c){c instanceof Siesta.Result.Assertion&&a.call(b,c)})},eachSubTest:function(a,b){b=b||this;this.getResults().each(function(c){if(c instanceof Siesta.Result.SubTest&&!1===a.call(b,c.test))return!1})},eachChildTest:function(a,b){b=b||this;this.getResults().eachChild(function(c){if(c instanceof Siesta.Result.SubTest&&!1===a.call(b,c.test))return!1})},
countKeys:function(a){var b=0;Joose.O.eachOwn(a,function(){b++});return b},compareObjects:function(a,b,c,d,e){var f=Joose.O.isInstance(a)&&a.meta.does(Siesta.Test.Role.Placeholder),g=Joose.O.isInstance(b)&&b.meta.does(Siesta.Test.Role.Placeholder);if(c){if(a===b)return!0}else if(a==b)return!0;if(f&&g)return a.equalsTo(b);if(g)return b.equalsTo(a);if(f)return a.equalsTo(b);if(d)return!1;d=this.typeOf(a);f=this.typeOf(b);if(d!=f)return!1;var h=this;if("Object"==d||e)return this.countKeys(a)!=this.countKeys(b)?
!1:!1===Joose.O.eachOwn(a,function(a,d){if(!h.compareObjects(a,b[d],c))return!1})?!1:!0;if("Array"==d){if(a.length!=b.length)return!1;for(e=0;e<a.length;e++)if(!this.compareObjects(a[e],b[e],c))return!1;return!0}return"Function"==d?a.toString()==b.toString()&&(!c||this.compareObjects(a,b,c,!1,!0)):"RegExp"==d?a.source==b.source&&a.global==b.global&&a.ignoreCase==b.ignoreCase&&a.multiline==b.multiline&&(!c||this.compareObjects(a,b,c,!1,!0)):"Date"==d?!Boolean(a-b)&&(!c||this.compareObjects(a,b,c,!1,
!0)):!1},ok:function(a,b){var c=Siesta.Resource("Siesta.Test");a?this.pass(b,{descTpl:c.get("isTruthy"),value:a}):this.fail(b,{assertionName:"ok",got:a,annotation:c.get("needTruthy")})},notok:function(){this.notOk.apply(this,arguments)},notOk:function(a,b){var c=Siesta.Resource("Siesta.Test");a?this.fail(b,{assertionName:"notOk",got:a,annotation:c.get("needFalsy")}):this.pass(b,{descTpl:c.get("isFalsy"),value:a})},is:function(a,b,c){var d=Siesta.Resource("Siesta.Test");b&&a instanceof this.global.Date?
this.isDateEqual(a,b,c):this.compareObjects(a,b,!1,!0)?this.pass(c,{descTpl:d.get("isEqualTo"),got:a,expected:b}):this.fail(c,{assertionName:"is",got:a,need:b})},isnot:function(){this.isNot.apply(this,arguments)},isnt:function(){this.isNot.apply(this,arguments)},isNot:function(a,b,c){var d=Siesta.Resource("Siesta.Test");this.compareObjects(a,b,!1,!0)?this.fail(c,{assertionName:"isnt",got:a,need:b,needDesc:d.get("needNot")}):this.pass(c,{descTpl:d.get("isNotEqualTo"),got:a,expected:b})},isStrict:function(a,
b,c){var d=Siesta.Resource("Siesta.Test");this.compareObjects(a,b,!0,!0)?this.pass(c,{descTpl:d.get("isStrictlyEqual"),got:a,expected:b}):this.fail(c,{assertionName:"isStrict",got:a,need:b,needDesc:d.get("needStrictly")})},isntStrict:function(){this.isNotStrict.apply(this,arguments)},isNotStrict:function(a,b,c){var d=Siesta.Resource("Siesta.Test");this.compareObjects(a,b,!0,!0)?this.fail(c,{assertionName:"isntStrict",got:a,need:b,needDesc:d.get("needStrictlyNot")}):this.pass(c,{descTpl:d.get("isStrictlyNotEqual"),
got:a,expected:b})},wait:function(a,b){var c=Siesta.Resource("Siesta.Test");if(this.waitTitles.hasOwnProperty(a))throw Error(c.get("alreadyWaiting")+" ["+a+"]");return this.waitTitles[a]=this.beginAsync(b)},endWait:function(a){var b=Siesta.Resource("Siesta.Test");if(!this.waitTitles.hasOwnProperty(a))throw Error(b.get("noOngoingWait")+" ["+a+"]");this.endAsync(this.waitTitles[a]);delete this.waitTitles[a]},beginAsync:function(a,b){a=a||this.defaultTimeout;var c=Siesta.Resource("Siesta.Test"),d=this,
e=this.originalSetTimeout,f=this.timeoutsCount.counter++,e=e(function(){d.hasAsyncFrame(f)&&(b&&b.call(d,d)||d.fail(c.get("noMatchingEndAsync")+" "+a+" "+Siesta.Resource("Siesta.Test.More","ms")),d.endAsync(f))},a);this.timeoutIds[f]=e;return f},timeoutIdToIndex:function(a){return"object"==typeof a?a.__index:this.idsToIndex[a]},hasAsyncFrame:function(a){return this.timeoutIds.hasOwnProperty(a)},hasAsyncFrameByTimeoutId:function(a){return this.timeoutIds.hasOwnProperty(this.timeoutIdToIndex(a))},endAsync:function(a){var b=
this.originalSetTimeout,c=this.originalClearTimeout||this.global.clearTimeout,d=0,e=Siesta.Resource("Siesta.Test");null==a&&Joose.O.each(this.timeoutIds,function(b,c){a=c;if(d++)throw Error(e.get("endAsyncMisuse"));});c(this.timeoutIds[a]);delete this.timeoutIds[a];var f=this;this.processed&&!this.isFinished()&&b(function(){f.finalize()},1)},clearTimeouts:function(){var a=this.originalClearTimeout;Joose.O.each(this.timeoutIds,function(b,c){a(b)});this.timeoutIds={}},skipIf:function(a,b,c,d){d=d||
1;if(a)for(a=1;a<=d;a++)this.addResult(new Siesta.Result.Assertion({passed:!0,isSkipped:!0,description:"SKIPPED: "+b}));else c()},skip:function(a,b,c){this.skipIf(!0,a,b,c)},processSubTestConfig:function(a){return Joose.O.extend({trait:Siesta.Test.Sub,parent:this,isTodo:this.isTodo,transparentEx:this.transparentEx,waitForTimeout:this.waitForTimeout,waitForPollInterval:this.waitForPollInterval,defaultTimeout:this.defaultTimeout,timeout:this.subTestTimeout,subTestTimeout:this.subTestTimeout,global:this.global,
url:this.url,scopeProvider:this.scopeProvider,harness:this.harness,generation:this.generation,overrideSetTimeout:this.overrideSetTimeout,originalSetTimeout:this.originalSetTimeout,originalClearTimeout:this.originalClearTimeout,timeoutsCount:this.timeoutsCount,autoCheckGlobals:!1,needToCleanup:!1},a)},getSubTest:function(a,b,c){var d,e=Siesta.Resource("Siesta.Test");2==arguments.length||3==arguments.length?d={name:a,run:b,timeout:c}:1==arguments.length&&"Function"==this.typeOf(a)&&(d={name:"Sub test",
run:a});d=d||a||{};null==d.timeout&&delete d.timeout;var f=d.name;if(!d.run)throw this.failWithException(e.get("codeBodyMissingForSubTest")+" ["+f+"]"),Error(e.get("codeBodyMissingForSubTest")+" ["+f+"]");if(!d.run.length)throw this.failWithException(e.get("codeBodyMissingTestArg").replace("{name}",f)),Error(e.get("codeBodyMissingTestArg").replace("{name}",f));return new (d.meta||this.constructor)(this.processSubTestConfig(d))},launchSubTest:function(a,b){var c=this,d=Siesta.Resource("Siesta.Test"),
e=a.timeout||this.subTestTimeout,f=this.beginAsync(e,function(){c.fail(d.get("Subtest")+" "+(a.name?"["+a.name+"]":"")+" "+d.get("failedToFinishWithin")+" "+e+" "+Siesta.Resource("Siesta.Test.More","ms"));c.restoreTimeoutOverrides();g.remove();a.finalize(!0);b&&b(a);return!0}),g=a.on("testfinalize",function(){c.endAsync(f);c.restoreTimeoutOverrides();b&&b(a)});this.addResult(a.getResults());a.start()},todo:function(a,b,c){"Function"==this.typeOf(a)&&(a=[b,b=a][0]);a=this.getSubTest({name:a,run:b,
isTodo:!0,transparentEx:!1});this.launchSubTest(a,c)},snooze:function(a,b,c){var d=Siesta.Resource("Siesta.Test");new Date>new Date(a)?b.call(this.global,this):this.todo(d.get("Snoozed until")+" "+new Date(a)+": "+(c||""),b)},subTest:function(a,b,c,d){a=this.getSubTest({name:a||Siesta.Resource("Siesta.Test","Subtest"),timeout:d,run:b});this.launchSubTest(a,c);return a},stringifyException:function(a,b){var c=a+"",d=(b||this.getStackTrace(a)||[]).join("\n");-1==d.indexOf(c)&&(d=c+d);return d},failWithException:function(a){var b=
Siesta.Resource("Siesta.Test");this.failed=!0;this.failedException=a+"";this.failedExceptionType=this.typeOf(a);var c=this.getStackTrace(a);this.addResult(new Siesta.Result.Assertion({isException:!0,exceptionType:this.failedExceptionType,passed:!1,description:(this.parent?b.get("Subtest")+" `"+this.name+"`":b.get("Test")+" ")+" "+b.get("threwException"),annotation:this.stringifyException(a,c)}));this.fireEvent("testfailedwithexception",this,a,c);this.finalize(!0)},restoreTimeoutOverrides:function(){this.overrideSetTimeout&&
(this.global.setTimeout=this.overrideForSetTimeout,this.global.clearTimeout=this.overrideForClearTimeout)},start:function(a){var b=Siesta.Resource("Siesta.Test");if(this.startDate)throw b.get("testAlreadyStarted");this.startDate=new Date-0;this.fireEvent("teststart",this);if(a)this.failWithException(a);else if(this.parent||this.reusingSandbox)this.launch();else{var c=this,d,e=function(a){var d=!1,e=setTimeout(function(){d=!0;c.launch(b.get("setupTookTooLong"))},c.isReadyTimeout);c.setup(function(){d||
(clearTimeout(e),c.launch())},function(a){d||(clearTimeout(e),c.launch(a))})},f=c.isReady();if(f.ready)e();else var g=setTimeout(function(){clearInterval(h);e(d)},c.isReadyTimeout),h=setInterval(function(){f=c.isReady();f.ready?(clearInterval(h),clearTimeout(g),e()):d=f.reason||d},100)}},setup:function(a,b){a.call(this)},tearDown:function(a,b){a.call(this)},earlySetup:function(a,b){a.call(this)},cleanupContextBeforeStart:function(){var a=this.global;this.forEachUnexpectedGlobal(function(b){try{delete a[b]}catch(c){}})},
clearAsyncFrameGlobally:function(a){for(var b=this;b.parent;)b=b.parent;b.eachSubTest(function(b){if(b.hasAsyncFrameByTimeoutId(a))return b.overrideForClearTimeout(a),!1})},launch:function(a){if(a){var b=Siesta.Resource("Siesta.Test");this.fail(b.get("errorBeforeTestStarted"),{annotation:a})}var c=this,d=this.global;a=this.scopeProvider;var e=this.originalSetTimeout,f=this.originalClearTimeout;this.overrideSetTimeout&&(this.reusingSandbox||a.runCode("var setTimeout, clearTimeout;"),d.setTimeout=this.overrideForSetTimeout=
function(a,b){var d=c.timeoutsCount.counter++,g=e(function(){f(g);delete c.timeoutIds[d];c.processed&&!c.isFinished()&&e(function(){c.finalize()},1);a()},b);"object"==typeof g?g.__index=d:c.idsToIndex[g]=d;return c.timeoutIds[d]=g},d.clearTimeout=this.overrideForClearTimeout=function(a){null!=a&&(c.hasAsyncFrameByTimeoutId(a)?(f(a),a=c.timeoutIdToIndex(a),null!=a&&delete c.timeoutIds[a],c.processed&&!c.isFinished()&&e(function(){c.finalize()},1)):c.clearAsyncFrameGlobally(a))});this.needToCleanup&&
(a.beforeCleanupCallback=function(){c.isFinished()||c.finalize(!0);c.overrideSetTimeout&&(d.setTimeout=e,d.clearTimeout=f);d=e=f=null;c.eachSubTest(function(a){a.cleanup()})});this.reusingSandbox&&this.sandboxCleanup&&this.cleanupContextBeforeStart();d.focus&&d.focus();var g=this.run;if(this.transparentEx)g(c);else var h=this.getExceptionCatcher()(function(){g(c)});this.afterLaunch(h)},cleanup:function(){this.scopeProvider=this.startTestAnchor=this.exceptionCatcher=this.testErrorClass=this.global=
this.run=this.originalSetTimeout=this.originalClearTimeout=this.overrideForSetTimeout=this.overrideForClearTimeout=null;this.purgeListeners()},afterLaunch:function(a){a?this.failWithException(a):this.finalize()},finalize:function(a){var b=this,c=Siesta.Resource("Siesta.Test");if(!b.finalizationStarted&&!b.isFinished())if(b.processed=!0,a&&(b.clearTimeouts(),b.eachChildTest(function(a){a.finalize(!0)})),Joose.O.isEmpty(b.timeoutIds)){if(!b.needDone&&!b.isDone){b.fireEvent("beforetestfinalizeearly",
b);if(!Joose.O.isEmpty(b.timeoutIds))if(a)b.clearTimeouts();else return;b.fireEvent("beforetestfinalize",b)}b.finalizationStarted=!0;var d=function(a){a&&b.fail(a);b.endDate=new Date-0;b.parent||b.addResult(new Siesta.Result.Summary({isFailed:b.isFailed(),description:b.getSummaryMessage()}));b.onTestFinalize();b.fireEvent("testfinalize",b);b.fireEvent("testendbubbling",b);b.callback&&b.callback();b.callback=null};if(b.parent||b.reusingSandbox)d();else{a=b.originalSetTimeout;var e=b.originalClearTimeout,
f=!1,g=a(function(){f=!0;d(c.get("testTearDownTimeout"))},b.isReadyTimeout);b.tearDown(function(){e(g);f||d()},function(a){e(g);f||d(a)})}}else!b.__timeoutWarning&&(b.overrideSetTimeout&&b.lastActivityDate&&new Date-b.lastActivityDate>2*b.defaultTimeout)&&(b.diag(c.get("testStillRunning")),b.warn(c.get("testNotFinalized").replace("{url}",b.url)),b.__timeoutWarning=!0)},onTestFinalize:function(){},getSummaryMessage:function(a){var b=[],c=this.getPassCount(),d=this.getFailCount(),e=this.assertPlanned,
f=d+c;b.push("Passed: "+c);b.push("Failed: "+d);this.failed||(null!=e?(f<e&&b.push("Looks like you planned "+e+" tests, but ran only "+f),f>e&&b.push("Looks like you planned "+e+" tests, but ran "+(f-e)+" extra tests, "+f+" total."),f!=e||d||b.push("All tests passed")):(c=Siesta.Resource("Siesta.Test"),this.isDoneCorrectly()||b.push(c.get("missingDoneCall")),this.isDoneCorrectly()&&!d&&b.push(c.get("allTestsPassed"))));return a?b.join(a):b},done:function(a){var b=this;if(a){var c=this.beginAsync(),
d=this.originalSetTimeout;d(function(){b.endAsync(c);b.done()},a)}else this.fireEvent("beforetestfinalizeearly"),this.fireEvent("beforetestfinalize"),this.isDone=!0,this.processed&&this.finalize()},isDoneCorrectly:function(){return!this.needDone||this.isDone},getAssertionCount:function(a){var b=0;this.eachAssertion(function(c){a&&c.isTodo||b++});return b},getPassCount:function(a){if(null!=this.$passCount&&!a)return this.$passCount;var b=0;this.eachAssertion(function(c){!c.passed||!a&&c.isTodo||b++});
return a?b:this.$passCount=b},getTodoPassCount:function(){var a=0;this.eachAssertion(function(b){b.isTodo&&b.passed&&a++});return a},getTodoFailCount:function(){var a=0;this.eachAssertion(function(b){b.isTodo&&!b.passed&&a++});return a},getFailCount:function(a){if(null!=this.$failCount&&!a)return this.$failCount;var b=0;this.eachAssertion(function(c){c.passed||!a&&c.isTodo||b++});return a?b:this.$failCount=b},getFailedAssertions:function(){var a=[];this.eachAssertion(function(b){b.isPassed()||a.push(b)});
return a},isPassed:function(){var a=this.getPassCount(),b=this.getFailCount(),c=this.assertPlanned;return this.isFinished()&&!this.failed&&!b&&(null!=c&&a==c||null==c&&this.isDoneCorrectly())},isFailed:function(){var a=this.getPassCount(),b=this.getFailCount(),c=this.assertPlanned;return this.failed||b||this.isFinished()&&(null!=c&&a!=c||null==c&&!this.isDoneCorrectly())},isFailedWithException:function(){return this.failed},isStarted:function(){return null!=this.startDate},isFinished:function(){return null!=
this.endDate},getDuration:function(){return this.endDate-this.startDate},getBubbleTarget:function(){return this.parent||this.harness},warn:function(a){this.addResult(new Siesta.Result.Diagnostic({description:a,isWarning:!0}))},flattenArray:function(a){var b=this,c=[];Joose.A.each(a,function(a){"Array"==b.typeOf(a)?c.push.apply(c,b.flattenArray(a)):c.push(a)});return c},trimString:function(a){return String(a).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},buildActionableMethods:function(){var a=
{};this.meta.getMethods().each(function(b,c){a[c.toLowerCase()]=c});return a},getJUnitClass:function(){return this.jUnitClass||this.meta.name||"Siesta.Test"},resource:function(){return Siesta.Resource.apply(Siesta.Resource,arguments)}}});
Singleton("Siesta.Test.ActionRegistry",{has:{actionClasses:Joose.I.Object},methods:{registerAction:function(a,b){this.actionClasses[a.toLowerCase()]=b},getActionClass:function(a){return this.actionClasses[a.toLowerCase()]},create:function(a,b,c){if(a!==Object(a))throw"Action configuration should be an Object instance";if(!a.action){var d=this.actionClasses,e={};b&&(e=b.getActionableMethods());Joose.O.eachOwn(a,function(b,c){var h=c.toLowerCase();if(d[h]){a.action=h;switch(h){case "waitfor":break;
case "type":a.text=b;break;default:a.target=b}return!1}if(e[h])return h.match(/^waitFor/i)?(a.action="wait",a.waitFor=e[h]):(a.action="methodCall",a.methodName=e[h]),a.args=b||[],!1})}if(!a.action)throw"Need to include `action` property or shortcut property in the step config";"wait"!=a.action&&("waitfor"!=a.action&&"delay"!=a.action&&"methodCall"!=a.action)&&(!a.args&&c)&&(a.args=c);return new (this.getActionClass(a.action))(a)}}});
Class("Siesta.Test.Action",{has:{args:null,desc:null,test:{required:!0},next:{required:!0},requiredTestMethod:null},methods:{initialize:function(){var a=this.requiredTestMethod;if(a&&!this.test[a])throw Error(Siesta.Resource("Siesta.Test.Action","missingTestAction").replace("{0}",this.meta.name).replace("{1}",a));},process:function(){this.next()}}});Class("Siesta.Test.Action.Done",{isa:Siesta.Test.Action,has:{delay:null},methods:{process:function(){this.test.done(this.delay);this.next()}}});
Siesta.Test.ActionRegistry().registerAction("done",Siesta.Test.Action.Done);
Class("Siesta.Test.Action.Wait",{isa:Siesta.Test.Action,has:{delay:1E3,timeout:null,args:Joose.I.Array,waitFor:null,trigger:null},methods:{process:function(){var a=this.waitFor,b=this.test;if("Number"===b.typeOf(a)||"Function"===b.typeOf(a))this.args=[a],a="";null==a&&(this.args=[this.delay],a="");"Function"===b.typeOf(this.args)&&"waitForFn"!=a&&(this.args=this.args.call(b,this));"Array"!==b.typeOf(this.args)&&(this.args=[this.args]);a=a.replace(/^waitFor/,"");a="waitFor"+Joose.S.uppercaseFirst(a);
if(!b[a])throw Siesta.Resource("Siesta.Test.Action.Wait","missingMethodText")+a;"waitFor"===a?b.waitFor({method:this.args[0],callback:this.next,scope:b,timeout:this.timeout||b.waitForTimeout,description:this.desc||""}):b[a].apply(b,this.args.concat(this.next,b,this.timeout||b.waitForTimeout));if(a=this.trigger)"Function"==b.typeOf(a)?a.call(b,b):(a instanceof Siesta.Test.Action||(a.next=function(){},a.test=this.test,a=Siesta.Test.ActionRegistry().create(a,b)),a.process())}}});
Joose.A.each(["wait","waitFor","delay"],function(a){Siesta.Test.ActionRegistry().registerAction(a,Siesta.Test.Action.Wait)});
Class("Siesta.Test.Action.Eval",{isa:Siesta.Test.Action,has:{actionString:null},methods:{process:function(){var a=this.test,b=this.parseActionString(this.actionString);if(b.error)a.fail(b.error),this.next();else{var c=b.methodName;c&&"Function"==a.typeOf(a[c])?(b.params.push(this.next),a[c].apply(a,b.params)):(a.fail(Siesta.Resource("Siesta.Test.Action.Eval","invalidMethodNameText")+c),this.next())}},parseActionString:function(a){var b=/^\s*(.+?)\(\s*(.*)\s*\)\s*$/.exec(a);if(!b)return{error:Siesta.Resource("Siesta.Test.Action.Eval",
"wrongFormatText")+a};a=b[1].replace(/^t\./,"");try{var c=JSON.parse("["+b[2]+"]")}catch(d){return{error:Siesta.Resource("Siesta.Test.Action.Eval","parseErrorText")+b[2]}}return{methodName:a,params:c}}}});
Class("Siesta.Test.Action.MethodCall",{isa:Siesta.Test.Action,has:{methodName:null,args:null,callbackIndex:null},methods:{process:function(){var a=this.test,b=this.methodName,c=this.args;"Function"==a.typeOf(c)&&(c=c.call(a,this));"Array"!=a.typeOf(c)&&(c=[c]);null!=this.callbackIndex?c.splice(this.callbackIndex,0,this.next):c.push(this.next);a[b].apply(a,c)}}});Siesta.Test.ActionRegistry().registerAction("methodCall",Siesta.Test.Action.MethodCall);
Class("Siesta.Harness",{does:[JooseX.Observable,Siesta.Util.Role.CanGetType],has:{title:null,testClass:Siesta.Test,contentManagerClass:Siesta.Content.Manager,descriptors:Joose.I.Array,descriptorsById:Joose.I.Object,launchCounter:0,launches:Joose.I.Object,scopesByURL:Joose.I.Object,testsByURL:Joose.I.Object,transparentEx:!1,scopeProviderConfig:null,scopeProvider:null,runCore:"parallel",maxThreads:4,autoCheckGlobals:!1,disableGlobalsCheck:!1,expectedGlobals:Joose.I.Array,cleanScopeGlobals:Joose.I.Array,
preload:Joose.I.Array,cachePreload:!1,mainPreset:null,emptyPreset:null,verbosity:0,keepNLastResults:2,lastResultsURLs:Joose.I.Array,lastResultsByURL:Joose.I.Object,overrideSetTimeout:!1,needDone:!1,needToStop:!1,increaseTimeoutThreshold:8,startDate:null,endDate:null,waitForTimeout:1E4,defaultTimeout:15E3,subTestTimeout:null,isReadyTimeout:1E4,pauseBetweenTests:300,failOnExclusiveSpecsWhenAutomated:!1,setupDone:!1,sourceLineForAllAssertions:!1,currentLaunchId:null},methods:{initialize:function(){var a=
this;a.on("testupdate",function(b,c,d,e){a.onTestUpdate(c,d,e)});a.on("testfailedwithexception",function(b,c,d,e){a.onTestFail(c,d,e)});a.on("teststart",function(b,c){a.onTestStart(c)});a.on("testfinalize",function(b,c){a.onTestEnd(c)})},onTestUpdate:function(a,b,c){},onTestFail:function(a,b,c){},onTestStart:function(a){},onTestEnd:function(a){},onTestSuiteStart:function(a,b){this.startDate=new Date;this.fireEvent("testsuitestart",this)},onTestSuiteEnd:function(a,b){this.endDate=new Date;this.fireEvent("testsuiteend",
this)},onBeforeScopePreload:function(a,b){this.fireEvent("beforescopepreload",a,b)},onAfterScopePreload:function(a,b){this.fireEvent("afterscopepreload",a,b)},onCachingError:function(a,b){},configure:function(a){Joose.O.copy(a,this);var b=this;a.listeners&&Joose.O.each(a.listeners,function(c,d){if("scope"!=d)b.on(d,c,a.scope||b)})},processPreloadArray:function(a){var b=this;Joose.A.each(a,function(c,d){Object(c)!==c&&(a[d]=b.normalizeURL(c))});return a},populateCleanScopeGlobals:function(a,b){var c=
new (eval(a)),d=this.cleanScopeGlobals;c.setup(function(){for(var a in c.scope)d.push(a);b();setTimeout(function(){c.cleanup()},0)})},startSingle:function(a,b){var c=this;this.__counter__=this.__counter__||0;var d=function(){c.launch([c.normalizeDescriptor(a,c,c.__counter__++)],b)};c.setupDone?d():this.setup(d)},setup:function(a){var b=this;this.mainPreset=new Siesta.Content.Preset({preload:this.processPreloadArray(this.preload)});this.emptyPreset=new Siesta.Content.Preset;this.populateCleanScopeGlobals(this.scopeProvider,
function(){b.setupDone=!0;a()})},start:function(){var a=Siesta.my.activeHarness=this,b=Array.prototype.concat.apply([],arguments);this.setup(function(){a.normalizeDescriptors(b);a.launch(a.descriptors)})},normalizeDescriptors:function(a){var b=this,c=[];Joose.A.each(a,function(a,e){a&&c.push(b.normalizeDescriptor(a,b,e))});b.descriptors=c},launch:function(a,b,c){var d=this.currentLaunchId=this.launchCounter++,e=this;this.needToStop=!1;var f=this.flattenDescriptors(a),g=new Siesta.Content.Preset,h=
[g,this.mainPreset];Joose.A.each(f,function(a){a.preset!=e.mainPreset&&a.preset!=e.emptyPreset&&h.push(a.preset);a.testCode||g.addResource(a.url);e.deleteTestByURL(a.url)});var k=new this.contentManagerClass({harness:this,presets:[g].concat(this.cachePreload?h:[])}),m=this.launches[d]={increaseTimeout:"parallel"==this.runCore&&f.length>this.increaseTimeoutThreshold,launchId:d,descriptors:f.slice(),descriptorsLeft:null,contentManager:k};e.onTestSuiteStart(a,k);k.cache(function(){Joose.A.each(f,function(a){var b=
a.url;k.hasContentOf(b)?(b=a.testConfig=Siesta.getConfigForTestScript(k.getContentOf(b)))&&(b.preload||b.alsoPreload)&&(a.preset=e.getDescriptorPreset(a)):a.testCode||e.markMissingFile(a);e.normalizeScopeProvider(a)});e.fireEvent("testsuitelaunch",a,k);e.runCoreGeneral(f,k,m,m.callback=function(){e.onTestSuiteEnd(a,k);b&&b(a);delete e.launches[d]})},function(){},!0)},markMissingFile:function(a){a.isMissing=!0},flattenDescriptors:function(a,b){var c=[],d=this;Joose.A.each(a,function(a){a.group?(b&&
c.push(a),c.push.apply(c,d.flattenDescriptors(a.items,b))):c.push(a)});return c},lookUpValueInDescriptorTree:function(a,b,c){var d=a.testConfig;if(d&&d.hasOwnProperty(b))return d[b];if(a.hasOwnProperty(b))return a[b];if(a=a.parent)return a==this?c?void 0:this[b]:this.lookUpValueInDescriptorTree(a,b,c)},getDescriptorConfig:function(a,b,c){return this.lookUpValueInDescriptorTree(a,b,c)},getDescriptorPreset:function(a){var b=this.getDescriptorConfig(a,"preload",!0);a=this.getDescriptorConfig(a,"alsoPreload",
!0);return b||a?(b=(b||this.preload).concat(a||[]),b.length?new Siesta.Content.Preset({preload:this.processPreloadArray(b)}):this.emptyPreset):this.mainPreset},normalizeScopeProvider:function(a){var b=this.getDescriptorConfig(a,"scopeProvider");if(b)var c,b=(c=/^=(.+)/.exec(b))?c[1]:b.replace(/^(Scope\.Provider\.)?/,"Scope.Provider.");a.scopeProvider=b;a.scopeProviderConfig=this.getDescriptorConfig(a,"scopeProviderConfig")},normalizeDescriptor:function(a,b,c,d){"string"==typeof a&&(a={url:a});d=d||
0;var e=this;a.parent=b;if(a.group){a.id=b==this?"testFolder-"+d+"-"+c:b.id+"/"+d+"-"+c;var f=[];Joose.A.each(a.items||[],function(b,c){b&&f.push(e.normalizeDescriptor(b,a,c,d+1))});a.items=f}else a.id=a.url,a.preset=this.getDescriptorPreset(a);return this.descriptorsById[a.id]=a},runCoreGeneral:function(a,b,c,d){var e="runCore"+Joose.S.uppercaseFirst(this.runCore);if("function"!=typeof this[e])throw Error("Invalid `runCore` specified: ["+this.runCore+"]");this[e](a,b,c,d)},runCoreParallel:function(a,
b,c,d){var e=this,f=0,g=a.length;g||d();for(var h=!1,k=!1,m=!1,r=function(l){e.processURL(l,l.index,b,c,function(){f++;e.needToStop||h?(h=!0,k||(k=!0,d())):f==g?d():s(a)})},s=function(a){var b=a.shift();b&&(m?setTimeout(function(){r(b)},e.pauseBetweenTests):r(b))},v=1;v<=this.maxThreads;v++)s(a);m=!0},runCoreSequential:function(a,b,c,d){c.descriptorsLeft||(c.descriptorsLeft=a);if(a.length&&!this.needToStop){var e=a.shift(),f=this,g=a.length;this.processURL(e,e.index,b,c,function(){a.length&&a.length==
g?setTimeout(function(){f.runCoreSequential(a,b,c,d)},f.pauseBetweenTests):d()})}else d()},getSeedingCode:function(a,b){return";("+function(a,b){StartTest=startTest=describe=function(){arguments.callee.args=arguments};StartTest.launchId=b;StartTest.id=a;StartTest.exceptionCatcher=function(a){var b;try{a()}catch(c){b=c}return b};StartTest.testErrorClass=Error}.toString()+")("+JSON.stringify(a.id)+", "+b+")"},getScopeProviderConfigFor:function(a,b){var c=Joose.O.copy(a.scopeProviderConfig||{});c.seedingCode=
this.getSeedingCode(a,b);return c},keepTestResult:function(a){if(this.lastResultsByURL[a]){var b=-1;Joose.A.each(this.lastResultsURLs,function(c,d){if(c==a)return b=d,!1});this.lastResultsURLs.splice(b,1);this.lastResultsURLs.push(a)}else this.lastResultsURLs.push(a),this.lastResultsByURL[a]=!0,this.lastResultsURLs.length>this.keepNLastResults&&this.releaseTestResult()},releaseTestResult:function(){if(!(this.lastResultsURLs.length<=this.keepNLastResults)){var a=this.lastResultsURLs.shift();delete this.lastResultsByURL[a];
var b=this.getTestByURL(a);b&&b.isFinished()&&this.cleanupScopeForURL(a)}},isKeepingResultForURL:function(a){return this.lastResultsByURL[a]},setupScope:function(a,b){var c=a.url,d=eval(a.scopeProvider);this.cleanupScopeForURL(c);this.keepTestResult(c);return this.scopesByURL[c]=new d(this.getScopeProviderConfigFor(a,b))},cleanupScopeForURL:function(a){var b=this.scopesByURL[a];b&&(delete this.scopesByURL[a],b.cleanup())},prepareScopeSeeding:function(a,b,c){b.testCode||this.cachePreload&&c.hasContentOf(b.url)?
a.addPreload({type:"js",content:b.testCode||c.getContentOf(b.url)+"\n//# sourceURL="+b.url}):a.seedingScript=this.resolveURL(b.url,a,b)},normalizeURL:function(a){return a},resolveURL:function(a,b,c){return a},canUseCachedContent:function(a){return this.cachePreload&&a instanceof Siesta.Content.Resource.JavaScript},addCachedResourceToPreloads:function(a,b,c){a.addPreload({type:"js",content:b.getContentOf(c)})},processURL:function(a,b,c,d,e,f){function g(b){s.setup(function(){h.onAfterScopePreload(s,
k,t);s.scope?h.launchTest({testHolder:m,desc:a,scopeProvider:s,contentManager:c,launchOptions:d,preloadErrors:b||r,onErrorHandler:v,startTestAnchor:s.scope.StartTest,noCleanup:f,reusingSandbox:!1},e):e()})}var h=this,k=a.url;if(a.isMissing)e();else{var m={},r=[],s=this.setupScope(a,d.launchId);b=this.getDescriptorConfig(a,"transparentEx");var v=function(a,b,c,d,e){(d=m.test)&&d.isStarted()?(d.nbrExceptions++,d.failWithException(e||a+" "+b+" "+c)):r.push(e&&e.stack?e.stack+"":a+" "+b+" "+c)};s.addOnErrorHandler(v,
!b);a.preset.eachResource(function(b){c.hasContentOf(b)&&h.canUseCachedContent(b)?h.addCachedResourceToPreloads(s,c,b):(b=b.asDescriptor(),b.url&&(b.url=h.resolveURL(b.url,s,a)),s.addPreload(b))});h.prepareScopeSeeding(s,a,c);b=h.getDescriptorConfig(a,"testClass");"String"==h.typeOf(b)&&(b=Joose.S.strToClass(b));var l=h.getNewTestConfiguration(a,s,c,d),t=m.test=new b(l);this.onBeforeScopePreload(s,k,t);t.earlySetup(function(){g()},function(a){g(a)})}},launchTest:function(a,b){var c=a.scopeProvider,
d=a.desc,e=this,f=d.url;c.addOnErrorHandler(a.onErrorHandler,!this.getDescriptorConfig(d,"transparentEx"));var g=a.testHolder.test,h=a.startTestAnchor,k=h&&h.args,d=c.scope,m=a.noCleanup;Joose.O.extend(g,{startTestAnchor:h,exceptionCatcher:h.exceptionCatcher,testErrorClass:h.testErrorClass,global:d,originalSetTimeout:a.originalSetTimeout||d.setTimeout,originalClearTimeout:a.originalClearTimeout||d.clearTimeout,run:k&&("function"==typeof k[0]?k[0]:k[1]),reusingSandbox:a.reusingSandbox,callback:function(){m||
e.isKeepingResultForURL(f)||e.cleanupScopeForURL(f);b&&b()}});this.saveTestWithURL(f,g);h=function(){e.fireEvent("beforeteststart",g);g.isFinished()||g.start(a.preloadErrors[0]);g=a=null};a.reusingSandbox?h():c instanceof Scope.Provider.IFrame?d.setTimeout(h,10):setTimeout(h,50)},getNewTestConfiguration:function(a,b,c,d){for(var e=[],f=a.parent;f;)f.parent&&e.unshift(String(f.group)),f=f.parent;b={url:a.url,name:a.name,groups:e,jUnitClass:this.getDescriptorConfig(a,"jUnitClass"),harness:this,expectedGlobals:this.cleanScopeGlobals.concat(this.getDescriptorConfig(a,
"expectedGlobals")),autoCheckGlobals:this.getDescriptorConfig(a,"autoCheckGlobals"),disableGlobalsCheck:this.disableGlobalsCheck,scopeProvider:b,contentManager:c,transparentEx:this.getDescriptorConfig(a,"transparentEx"),needDone:this.getDescriptorConfig(a,"needDone"),overrideSetTimeout:this.getDescriptorConfig(a,"overrideSetTimeout"),defaultTimeout:this.getDescriptorConfig(a,"defaultTimeout")*(d.increaseTimeout?2:1),subTestTimeout:this.getDescriptorConfig(a,"subTestTimeout")*(d.increaseTimeout?2:
1),waitForTimeout:this.getDescriptorConfig(a,"waitForTimeout")*(d.increaseTimeout?3:1),isReadyTimeout:this.getDescriptorConfig(a,"isReadyTimeout"),sourceLineForAllAssertions:this.sourceLineForAllAssertions,sandboxCleanup:this.getDescriptorConfig(a,"sandboxCleanup"),config:this.getDescriptorConfig(a,"config"),failOnExclusiveSpecsWhenAutomated:this.getDescriptorConfig(a,"failOnExclusiveSpecsWhenAutomated")};(a.testConfig||a.config)&&Joose.O.extend(b,a.testConfig||a.config);return b},getScriptDescriptor:function(a){return this.descriptorsById[a]},
getTestByURL:function(a){return this.testsByURL[a]},saveTestWithURL:function(a,b){this.testsByURL[a]=b},deleteTestByURL:function(a){var b=this.testsByURL[a];if(b){try{b.finalize(!0)}catch(c){}this.cleanupScopeForURL(a)}delete this.testsByURL[a]},allPassed:function(){var a=!0,b=this;Joose.A.each(this.flattenDescriptors(this.descriptors),function(c){if(c.isMissing)return a=!1;(c=b.getTestByURL(c.url))&&(a=a&&c.isPassed())});return a},generateReport:function(a){arguments.length||(a=__REPORT_OPTIONS__);
Object(a)!==a&&(a={format:a||"JSON"});var b="generate"+a.format+"Report";if(!this[b])throw"Can't generate report - missing the `"+b+"` method";return this[b](a)}}});
Role("Siesta.Role.CanStyleOutput",{has:{disableColoring:!1,style:{is:"rwc",lazy:"this.buildStyle"},styles:{init:{bold:[1,22],italic:[3,23],underline:[4,24],"black ":[30,39],yellow:[33,39],cyan:[36,39],white:[37,39],green:[32,39],red:[31,39],grey:[90,39],blue:[34,39],magenta:[35,39],"bgblack ":[40,49],bgyellow:[43,49],bgcyan:[46,49],bgwhite:[47,49],bggreen:[42,49],bgred:[41,49],bggrey:[100,49],bgblue:[44,49],bgmagenta:[45,49],inverse:[7,27]}}},methods:{buildStyle:function(){var a=this,b={};Joose.O.each(this.styles,
function(c,d){b[d]=function(b){return a.styled(b,d)}});return b},styled:function(a,b){if(this.disableColoring)return a;var c=this.styles;return"\u001b["+c[b][0]+"m"+a+"\u001b["+c[b][1]+"m"}}});
Role("Siesta.Role.ConsoleReporter",{requires:["log","exit","allPassed"],does:[Siesta.Role.CanStyleOutput],has:{needSummaryMessage:!0},after:{markMissingFile:function(a){this.warn(Siesta.Resource("Siesta.Role.ConsoleReporter","missingFileText").replace("{URL}",a.url))},onTestSuiteStart:function(){},onTestSuiteEnd:function(){this.exit(this.getExitCode())},onTestEnd:function(a){var b=a.isPassed();this.log("["+(b?this.style().green(Siesta.Resource("Siesta.Role.ConsoleReporter","passText")):this.style().red(Siesta.Resource("Siesta.Role.ConsoleReporter",
"failText")))+"]  "+a.url+(b?"":"\n"))},onTestUpdate:function(a,b,c){a=b+"";c=0<this.verbosity;if(b instanceof Siesta.Result.Assertion){if(b.isWaitFor&&!b.completed)return;b.isException&&!b.isTodo?(a=this.style().bold(this.style().red(a)),c=!0):b.isTodo?(a=this.styled(a,b.passed?"magenta":"yellow"),b.passed&&!b.isWaitFor&&(c=!0)):(a=this.styled(a,b.passed?"green":"red"),b.passed||(c=!0))}if(b instanceof Siesta.Result.Diagnostic&&(a=this.styled(a,"bold"),b.isWarning)){this.logWarning(b);return}b instanceof
Siesta.Result.Summary&&(c=this.needSummaryMessage,a=this.styled(b.description.join(""),"bold"));c&&this.log(a)}},methods:{warn:function(a){this.log(this.styled("["+Siesta.Resource("Siesta.Role.ConsoleReporter","warnText")+"] ","red")+a)},logWarning:function(a){this.warn(a+"")},getSummaryMessage:function(a){return(a=null!=a?a:this.allPassed())?this.style().bold(this.style().green(Siesta.Resource("Siesta.Role.ConsoleReporter","allTestsPassedText"))):this.style().bold(this.style().red(Siesta.Resource("Siesta.Role.ConsoleReporter",
"failuresFoundText")))},getExitCode:function(){return this.allPassed()?0:1}}});Class("Siesta.Content.Manager.NodeJS",{isa:Siesta.Content.Manager,methods:{load:function(a,b,c){try{var d=require("fs").readFileSync(a,"utf8")}catch(e){c(e);return}b(d)}}});
Class("Siesta.Harness.NodeJS",{my:{isa:Siesta.Harness,does:Siesta.Role.ConsoleReporter,has:{contentManagerClass:Siesta.Content.Manager.NodeJS,scopeProvider:"Scope.Provider.NodeJS",chdirToIndex:!0},before:{start:function(){this.runCore="sequential";if(this.chdirToIndex){var a=process.argv[1],b=require("path");process.chdir(b.dirname(a))}}},methods:{log:console.log,exit:process.exit,getScopeProviderConfigFor:function(a,b){var c=this.SUPER(a,b);c.sourceURL=a.url;return c},normalizeURL:function(a){/\.js$/.test(a)||
(a="../lib/"+a.replace(/\./g,"/")+".js");return a}}}});module.exports=Siesta.Harness.NodeJS;
